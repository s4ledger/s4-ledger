import"./engine-CQ2cTA5K.js";import"./enhancements-ppcVMndY.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const u of s)if(u.type==="childList")for(const m of u.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&i(m)}).observe(document,{childList:!0,subtree:!0});function n(s){const u={};return s.integrity&&(u.integrity=s.integrity),s.referrerPolicy&&(u.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?u.credentials="include":s.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(s){if(s.ep)return;s.ep=!0;const u=n(s);fetch(s.href,u)}})();document.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!1);document.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation()},!1);window.S4=window.S4||{version:"5.12.0",modules:{},register:function(e,a){this.modules[e]=a},getModule:function(e){return this.modules[e]||null}};S4.i18n={locale:(navigator.language||"en").split("-")[0],catalogs:{en:{"app.name":"S4 Ledger","nav.platform":"Platform","nav.useCases":"Use Cases","nav.pricing":"Pricing","nav.company":"Company","nav.docs":"Docs","nav.requestDemo":"Request Demo","anchor.title":"Anchor Channel","anchor.placeholder":"Or paste/type your defense logistics record here...","anchor.button":"Anchor Record","verify.title":"Verify Channel","verify.placeholder":"Paste the original defense record content here...","vault.title":"Audit Record Vault","vault.empty":"No anchored records yet. Records will appear here automatically as you anchor them.","vault.search":"Search records by type, hash, content...","vault.exportCSV":"Export CSV","vault.exportXLSX":"Export XLSX","vault.reverifyAll":"Re-Verify All","vault.clear":"Clear Vault","toast.missingContent":"Please enter record content.","toast.noProgram":"Please select a program first.","toast.noAnalysis":"Run analysis first.","toast.copied":"Copied to clipboard!","toast.exported":"records exported.","toast.verified":"records re-verified.","shortcuts.title":"Keyboard Shortcuts","search.placeholder":"Search records, vault, tools, documents...","search.noResults":"No results found"}},setLocale:function(e){this.locale=e},t:function(e){var a=this.catalogs[this.locale]||this.catalogs.en;return a[e]||this.catalogs.en[e]||e}};window.S4.t=S4.i18n.t.bind(S4.i18n);window.onerror=function(e,a,n,i,s){return console.error("[S4 Error]",e,"at",a,n+":"+i),!0};window.addEventListener("unhandledrejection",function(e){console.warn("[S4 Unhandled Promise]",e.reason)});(function(){var e=document.createElement("div");S4.sanitize=function(t){return typeof t!="string"?"":(e.textContent=t,e.innerHTML)},S4.sanitizeHTML=function(t){if(typeof t!="string")return"";var o=document.createElement("div");o.innerHTML=t;for(var r=o.querySelectorAll("script,iframe,object,embed,form"),l=r.length-1;l>=0;l--)r[l].remove();for(var c=o.querySelectorAll("*"),d=0;d<c.length;d++)for(var f=c[d].attributes,h=f.length-1;h>=0;h--)(f[h].name.startsWith("on")||f[h].value.indexOf("javascript:")===0)&&c[d].removeAttribute(f[h].name);return o.innerHTML};var a=1800*1e3,n=null,i=!1;S4.sessionTimeout=a;function s(){i||(clearTimeout(n),n=setTimeout(function(){i=!0,S4.sessionLocked=!0;var t=document.getElementById("s4SessionLockOverlay");t&&(t.style.display="flex"),typeof s4Notify=="function"&&s4Notify("Session Locked","Inactive for 30 minutes. Click to resume.","warning")},a))}S4.resumeSession=function(){i=!1,S4.sessionLocked=!1;var t=document.getElementById("s4SessionLockOverlay");t&&(t.style.display="none"),s()},["mousemove","mousedown","keydown","scroll","touchstart"].forEach(function(t){document.addEventListener(t,s,{passive:!0})}),s();var u=null;S4.crypto={_getKey:async function(){if(u)return u;var t=sessionStorage.getItem("s4_enc_key");if(t){var o=Uint8Array.from(atob(t),function(l){return l.charCodeAt(0)});return u=await crypto.subtle.importKey("raw",o,"AES-GCM",!0,["encrypt","decrypt"]),u}u=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);var r=await crypto.subtle.exportKey("raw",u);return sessionStorage.setItem("s4_enc_key",btoa(String.fromCharCode.apply(null,new Uint8Array(r)))),u},encrypt:async function(t){var o=await this._getKey(),r=crypto.getRandomValues(new Uint8Array(12)),l=new TextEncoder().encode(t),c=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},o,l),d=new Uint8Array(r.length+c.byteLength);return d.set(r),d.set(new Uint8Array(c),r.length),btoa(String.fromCharCode.apply(null,d))},decrypt:async function(t){var o=await this._getKey(),r=Uint8Array.from(atob(t),function(f){return f.charCodeAt(0)}),l=r.slice(0,12),c=r.slice(12),d=await crypto.subtle.decrypt({name:"AES-GCM",iv:l},o,c);return new TextDecoder().decode(d)}},S4.auditChain={computeChainHash:async function(t,o){var r=(o||"0".repeat(64))+"|"+t.hash+"|"+t.timestamp,l=new TextEncoder().encode(r),c=await crypto.subtle.digest("SHA-256",l);return Array.from(new Uint8Array(c)).map(function(d){return d.toString(16).padStart(2,"0")}).join("")},verifyChain:async function(t){if(!t||t.length===0)return{valid:!0,errors:[]};for(var o=[],r="0".repeat(64),l=0;l<t.length;l++)if(t[l].chainHash){var c=await this.computeChainHash(t[l],r);t[l].chainHash!==c&&o.push({index:l,expected:c,got:t[l].chainHash,record:t[l].label||t[l].type}),r=t[l].chainHash}else r=t[l].hash||r;return{valid:o.length===0,errors:o}}};var m={};S4.rateLimit=function(t,o){o=o||30;var r=Date.now();return m[t]||(m[t]=[]),m[t]=m[t].filter(function(l){return r-l<6e4}),m[t].length>=o?!1:(m[t].push(r),!0)},S4.csrf=(function(){var t=null;function o(){var r=new Uint8Array(32);return crypto.getRandomValues(r),Array.from(r,function(l){return l.toString(16).padStart(2,"0")}).join("")}return{getToken:function(){return t||(t=o()),t},refresh:function(){return t=o(),t},validate:function(r){return r&&r===t},addToHeaders:function(r){return r=r||{},r["X-CSRF-Token"]=this.getToken(),r}}})(),S4.zkVerify=async function(t){var o=typeof s4Vault<"u"&&s4Vault.some(function(f){return f.hash===t}),r={timestamp:new Date().toISOString(),claim:"Record with hash prefix "+t.substring(0,8)+"... exists in vault",verified:o,proofHash:null},l=crypto.getRandomValues(new Uint8Array(16)),c=new TextEncoder().encode(JSON.stringify(r)+Array.from(l).join("")),d=await crypto.subtle.digest("SHA-256",c);return r.proofHash=Array.from(new Uint8Array(d)).map(function(f){return f.toString(16).padStart(2,"0")}).join(""),r},S4.register("security",{version:"1.0.0",features:["xss-sanitizer","session-timeout","encrypted-storage","audit-chain","rate-limiter","zk-verify"]}),console.log("[S4 Security] Module loaded — 6 features active")})();sessionStorage.getItem("s4_entered")==="1"&&(document.getElementById("platformLanding").style.display="none",document.querySelector(".hero").style.display="none",document.getElementById("platformWorkspace").style.display="block");document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector('a[href="#tabWallet"]');e&&e.addEventListener("shown.bs.tab",function(){var a=document.getElementById("demoPanel");a&&(a.style.display="block")}),document.querySelectorAll('.nav-link[data-bs-toggle="pill"]').forEach(function(a){a.getAttribute("href")!=="#tabWallet"&&a.addEventListener("shown.bs.tab",function(){var n=document.getElementById("demoPanel");n&&(n.style.display="none")})})});window.addEventListener("scroll",function(){var e=window.scrollY,a=document.documentElement.scrollHeight-window.innerHeight,n=document.getElementById("scrollProgress");n&&(n.style.width=(a>0?e/a*100:0)+"%");var i=document.getElementById("backToTop");i&&(e>400?(i.style.opacity="1",i.style.visibility="visible"):(i.style.opacity="0",i.style.visibility="hidden"))});var ye=new IntersectionObserver(function(e){e.forEach(function(a){a.isIntersecting&&a.target.classList.add("visible")})},{threshold:.1});document.querySelectorAll(".reveal-demo").forEach(function(e){ye.observe(e)});function re(){const e=JSON.parse(localStorage.getItem("s4_wallet")||"null"),a=document.getElementById("walletNoWallet"),n=document.getElementById("walletCredentials");if(!e||!e.wallet){a&&(a.style.display="block"),n&&(n.style.display="none");return}a&&(a.style.display="none"),n&&(n.style.display="block"),document.getElementById("walletAddress").textContent=e.wallet.address,document.getElementById("seedRevealed").textContent=e.wallet.seed;const i=e.wallet.network==="mainnet"?"https://livenet.xrpl.org/accounts/":"https://testnet.xrpl.org/accounts/";document.getElementById("demoWalletExplorer").href=i+e.wallet.address,Se(e.wallet.address)}async function Se(e){try{const r=await(await fetch("/api/wallet/balance?address="+encodeURIComponent(e))).json();if(r.error){document.getElementById("walletSLSBalance").textContent="0",document.getElementById("walletAnchors").textContent="0",document.getElementById("walletXRP").textContent="0";return}document.getElementById("walletSLSBalance").textContent=parseFloat(r.sls_balance).toLocaleString(),document.getElementById("walletSLSUSD").textContent=(parseFloat(r.sls_balance)*r.sls_price_usd).toFixed(2),document.getElementById("walletAnchors").textContent=r.anchors_available.toLocaleString(),document.getElementById("walletXRP").textContent=r.xrp_balance.toFixed(2),document.getElementById("walletNetwork").textContent="XRPL "+r.network.charAt(0).toUpperCase()+r.network.slice(1)}catch(o){if(console.log("Balance fetch error:",o),_demoSession&&_demoSession.subscription){var a=_demoSession.subscription.sls_allocation||25e3,n=typeof stats<"u"&&stats.slsFees||0,i=Math.round((a-n)*100)/100,s=document.getElementById("walletSLSBalance");s&&(s.textContent=i.toLocaleString(void 0,{maximumFractionDigits:2}));var u=document.getElementById("walletAnchors");u&&(u.textContent=Math.floor(i/.01).toLocaleString());var m=document.getElementById("walletXRP");m&&(m.textContent="12.00");var t=document.getElementById("walletNetwork");t&&(t.textContent="XRPL Mainnet (Demo)")}}}setTimeout(function(){var e=document.getElementById("platformWorkspace");e&&e.style.display==="block"&&typeof loadPerformanceMetrics=="function"&&loadPerformanceMetrics().catch(function(a){console.warn("[S4] metrics load:",a)})},2e3);document.addEventListener("shown.bs.tab",function(e){e.target.getAttribute("href")==="#tabWallet"&&re()});window.location.hash==="#tabWallet"&&document.addEventListener("DOMContentLoaded",()=>setTimeout(re,500));var G=0;localStorage.getItem("s4_selected_tier");function Ce(){var e=document.getElementById("onboardOverlay");e&&(e.style.display="flex"),G=0,xe()}function xe(){for(var e=0;e<=4;e++){var a=document.getElementById("onboardStep"+e);a&&a.classList.toggle("active",e===G)}var n=document.querySelectorAll("#onboardProgress .onboard-dot");n.forEach(function(i,s){i.classList.remove("active","done"),s===G?i.classList.add("active"):s<G&&i.classList.add("done")})}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("platformWorkspace");e&&e.style.display==="block"&&!sessionStorage.getItem("s4_onboard_done")&&setTimeout(Ce,600)});var P=null,z=null;async function K(){var e=stats.anchored||0;stats.slsFees;var a=getLocalRecords(),n={};a.forEach(function(b){var E=b.record_label||b.record_type||"Unknown";n[E]=(n[E]||0)+1});try{var i=await fetch("/api/metrics/performance"),s=await i.json(),u=function(b,E){var T=document.getElementById(b);T&&(T.textContent=E)};u("metricAnchorTime",s.avg_anchor_time_ms?(s.avg_anchor_time_ms/1e3).toFixed(2):"3.21"),u("metricAnchorsToday",s.anchors_today||(e>0?e:"—")),u("metricCostPerAnchor",s.cost_per_anchor||"0.01"),u("metricValidators",s.xrpl_validators||"35"),u("metricUptime",s.uptime_pct||"99.97"),u("metricAiAudit",s.ai_audit_entries||(e>0?Math.max(e,1):"—"));var m=[];try{m=JSON.parse(localStorage.getItem(_vaultKey())||"[]")}catch{}var t=a.length+m.length;u("metricRecordsGenerated",t>0?t:"—"),u("metricVaultSize",m.length>0?m.length:"—");var o=0;try{o=Math.round(new Blob([localStorage.getItem(_vaultKey())||""]).size/1024*10)/10}catch{}u("metricStorageUsed",o>0?o.toFixed(1):"—"),u("metricTotalTime",s.total_processing_time||(e>0?(e*3.2).toFixed(1):"—"));var r=document.getElementById("chartAnchorTimes");if(r&&typeof Chart<"u"){var l=s.recent_anchor_times||Array.from({length:20},function(){return(2.8+Math.random()*1.5).toFixed(2)});P&&P.destroy(),P=new Chart(r,{type:"line",data:{labels:l.map(function(b,E){return"#"+(E+1)}),datasets:[{label:"Anchor Time (s)",data:l,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}})}var c=document.getElementById("chartRecordTypes");if(c&&typeof Chart<"u"){var d=s.record_type_counts||(Object.keys(n).length>0?n:{DD1149:12,DD250:8,WAWF:5,Container:14,"Supply Chain":9,Custody:7,Maintenance:6});z&&z.destroy(),z=new Chart(c,{type:"doughnut",data:{labels:Object.keys(d),datasets:[{data:Object.values(d),backgroundColor:["#00aaff","#c9a84c","#38bdf8","#ff6b6b","#00aaff","#fb923c","#06b6d4"],borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:10},padding:8}}}}})}var f=document.getElementById("metricsRecentRequests");f&&s.recent_requests&&s.recent_requests.length?f.innerHTML=s.recent_requests.map(function(b){var E=(b.method||"GET")==="POST"?"#00cc66":"#00aaff";return'<div style="display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="background:'+E+"22;color:"+E+';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center">'+(b.method||"GET")+'</span><span style="color:var(--text);flex:1;font-family:monospace;font-size:0.72rem">'+(b.path||b.endpoint||"/api/anchor")+'</span><span style="color:var(--accent);font-size:0.68rem;font-weight:600">'+(b.time||b.duration||b.latency||"—")+'</span><span style="color:var(--muted);font-size:0.68rem">'+(b.timestamp||b.ts||"")+"</span></div>"}).join(""):f&&(f.innerHTML='<div style="color:var(--muted);text-align:center;padding:1rem">No recent requests. Metrics auto-refresh when data is available.</div>')}catch{console.warn("Metrics load info: using local session data");var u=function(L,O){var D=document.getElementById(L);D&&(D.textContent=O)};u("metricAnchorTime",e>0?(2.8+Math.random()*.5).toFixed(2):"—"),u("metricAnchorsToday",e>0?e:"—"),u("metricCostPerAnchor","0.01"),u("metricValidators","35"),u("metricUptime","99.97"),u("metricAiAudit",e>0?Math.max(e,1):"—");var h=[];try{h=JSON.parse(localStorage.getItem(_vaultKey())||"[]")}catch{}var v=a.length+h.length;u("metricRecordsGenerated",v>0?v:"—"),u("metricVaultSize",h.length>0?h.length:"—");var g=0;try{g=Math.round(new Blob([localStorage.getItem(_vaultKey())||""]).size/1024*10)/10}catch{}u("metricStorageUsed",g>0?g.toFixed(1):"—"),u("metricTotalTime",e>0?(e*3.2).toFixed(1):"—");var r=document.getElementById("chartAnchorTimes");if(r&&typeof Chart<"u"){var l=Array.from({length:Math.max(e,10)},function(){return(2.8+Math.random()*1.2).toFixed(2)});typeof P<"u"&&P&&P.destroy(),P=new Chart(r,{type:"line",data:{labels:l.map(function(O,D){return"#"+(D+1)}),datasets:[{label:"Anchor Time (s)",data:l,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}})}var c=document.getElementById("chartRecordTypes");if(c&&typeof Chart<"u"){var d=Object.keys(n).length>0?n:{"No Records Yet":1};typeof z<"u"&&z&&z.destroy(),z=new Chart(c,{type:"doughnut",data:{labels:Object.keys(d),datasets:[{data:Object.values(d),backgroundColor:["#00aaff","#c9a84c","#38bdf8","#ff6b6b","#00aaff","#fb923c","#06b6d4"],borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:10},padding:8}}}}})}var f=document.getElementById("metricsRecentRequests");if(f){for(var x=[],I=typeof getLocalRecords=="function"?getLocalRecords():[],y=I.slice(-5).reverse(),C=0;C<y.length;C++){var A=y[C],p=Math.floor((Date.now()-new Date(A.timestamp).getTime())/1e3),S=p<60?p+"s ago":p<3600?Math.floor(p/60)+"m ago":Math.floor(p/3600)+"h ago";x.push({method:"POST",path:"/api/anchor",time:(2.5+Math.random()*1.5).toFixed(1)+"s",ts:S,color:"#00cc66",detail:A.record_label||A.record_type||"Record"}),x.push({method:"GET",path:"/api/verify/"+(A.hash||"sha256").substring(0,12),time:(.3+Math.random()*.3).toFixed(1)+"s",ts:S,color:"#00aaff",detail:"Verify "+(A.record_label||"")})}var w=[{method:"GET",path:"/api/metrics/performance",time:"0.2s",ts:"auto",color:"#00aaff",detail:"Metrics refresh"},{method:"GET",path:"/api/health",time:"0.1s",ts:"auto",color:"#00aaff",detail:"Health check"},{method:"GET",path:"/api/records?limit=50",time:"0.4s",ts:"realtime",color:"#00aaff",detail:"Record listing"},{method:"POST",path:"/api/wallet/balance",time:"0.3s",ts:"auto",color:"#00cc66",detail:"Balance check"},{method:"GET",path:"/api/xrpl/account_info",time:"0.8s",ts:"auto",color:"#00aaff",detail:"XRPL query"}],_=x.length>0?x.concat(w):[{method:"POST",path:"/api/anchor",time:"2.8s",ts:"just now",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/verify/sha256:a1b2c3d4",time:"0.4s",ts:"12s ago",color:"#00aaff",detail:"Verify hash"},{method:"POST",path:"/api/anchor",time:"3.1s",ts:"45s ago",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/metrics/performance",time:"0.2s",ts:"1m ago",color:"#00aaff",detail:"Metrics"},{method:"GET",path:"/api/records?limit=50&branch=NAVY",time:"0.3s",ts:"2m ago",color:"#00aaff",detail:"Record query"},{method:"POST",path:"/api/anchor",time:"2.6s",ts:"3m ago",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/verify/sha256:e5f6a7b8",time:"0.5s",ts:"4m ago",color:"#00aaff",detail:"Verify hash"},{method:"POST",path:"/api/ai-chat",time:"1.2s",ts:"5m ago",color:"#00cc66",detail:"AI query"}];f.innerHTML=_.slice(0,12).map(function(L){return'<div style="display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="background:'+L.color+"22;color:"+L.color+';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center">'+L.method+'</span><span style="color:var(--text);flex:1;font-family:monospace;font-size:0.72rem">'+L.path+'</span><span style="color:var(--steel);font-size:0.65rem;max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+L.detail+'</span><span style="color:var(--accent);font-size:0.68rem;font-weight:600">'+L.time+'</span><span style="color:var(--muted);font-size:0.68rem">'+L.ts+"</span></div>"}).join("")}}}document.addEventListener("shown.bs.tab",function(e){e.target&&e.target.getAttribute("href")==="#tabMetrics"&&K(),e.target&&e.target.getAttribute("href")==="#tabOffline"&&Ie()});setInterval(function(){var e=document.getElementById("tabMetrics");e&&e.classList.contains("active")&&typeof K=="function"&&K()},3e4);(function(){function e(){var a=typeof stats<"u"?stats:{anchored:0,slsFees:0};typeof getLocalRecords=="function"&&getLocalRecords();var n=document.getElementById("slsBarBalance");if(n){var i=a.slsFees||0,s=typeof _onboardTiers<"u"&&typeof _onboardTier<"u"&&_onboardTiers[_onboardTier]?_onboardTiers[_onboardTier].sls:typeof _demoSession<"u"&&_demoSession.subscription&&_demoSession.subscription.sls_allocation||25e3,u=s-i;n.textContent=u.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})}var m=document.getElementById("slsBarAnchors");m&&(m.textContent=a.anchored||0);var t=document.getElementById("slsBarSpent");t&&(t.textContent=(a.slsFees||0).toFixed(2));var o=typeof _onboardTiers<"u"&&typeof _onboardTier<"u"&&_onboardTiers[_onboardTier]?_onboardTiers[_onboardTier].sls:typeof _demoSession<"u"&&_demoSession.subscription&&_demoSession.subscription.sls_allocation||25e3,r=document.getElementById("toolSlsBal");r&&(r.textContent=(o-(a.slsFees||0)).toLocaleString());var l=document.getElementById("toolSlsAnch");l&&(l.textContent=a.anchored||0);var c=document.getElementById("toolSlsSpent");c&&(c.textContent=(a.slsFees||0).toFixed(2));try{var d=JSON.parse(localStorage.getItem("s4ActionItems")||"[]"),f=d.filter(function(v){return v.status!=="Closed"&&v.status!=="Resolved"}).length,h=document.getElementById("actionItemBadge");h&&(h.textContent=f>0?f:"",h.style.display=f>0?"inline-flex":"none")}catch{}}setInterval(e,3e3),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()})();var U="s4_offline_queue",ne="s4_offline_last_sync",oe="s4_offline_queue_enc",j=null;async function we(){if(j)return j;var e=navigator.userAgent+"|"+location.origin+"|s4ledger_offline_v1",a=new TextEncoder,n=await crypto.subtle.importKey("raw",a.encode(e),"PBKDF2",!1,["deriveKey"]);return j=await crypto.subtle.deriveKey({name:"PBKDF2",salt:a.encode("s4_offline_salt_v1"),iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),j}async function Ee(e){var a=await we(),n=crypto.getRandomValues(new Uint8Array(12)),i=new TextEncoder,s=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},a,i.encode(JSON.stringify(e)));return{iv:Array.from(n),data:Array.from(new Uint8Array(s))}}function Q(){try{var e=localStorage.getItem(oe);return e?Z||[]:JSON.parse(localStorage.getItem(U)||"[]")}catch{return[]}}var Z=[];async function Ae(e){try{var a=await Ee(e);localStorage.setItem(oe,JSON.stringify(a)),Z=e}catch(n){console.warn("Queue encrypt error, falling back to plain:",n),localStorage.setItem(U,JSON.stringify(e))}}function ie(e){Z=e,localStorage.setItem(U,JSON.stringify(e)),Ae(e).then(function(){localStorage.removeItem(U)}).catch(function(){}),W()}function W(){var e=Q(),a=document.getElementById("offlineQueueCount"),n=document.getElementById("offlineQueueList"),i=document.getElementById("offlineLastSync"),s=document.getElementById("offlineStatus");if(a&&(a.textContent=e.length),i){var u=localStorage.getItem(ne);i.textContent=u?new Date(u).toLocaleString():"Never"}if(s){var m=navigator.onLine;s.innerHTML=m?'<i class="fas fa-circle" style="font-size:0.6rem;color:var(--green)"></i> Online':'<i class="fas fa-circle" style="font-size:0.6rem;color:var(--red)"></i> Offline',s.style.color=m?"var(--green)":"var(--red)"}n&&(e.length?n.innerHTML=e.map(function(t,o){return'<div style="display:flex;align-items:center;gap:8px;padding:8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="color:var(--accent);font-weight:700;width:24px">'+(o+1)+'</span><span style="flex:1;color:var(--text);font-family:monospace;font-size:0.72rem">'+(t.hash?t.hash.substring(0,24)+"...":"N/A")+'</span><span style="color:var(--steel);font-size:0.7rem;width:80px">'+(t.record_type||"GENERAL")+'</span><span style="color:'+(t.synced?"var(--green)":"var(--gold)")+';font-size:0.72rem">'+(t.synced?"✓ Synced":"⏳ Pending")+'</span><button onclick="offlineRemoveItem('+o+')" style="background:none;border:none;color:var(--red);cursor:pointer;font-size:0.75rem" title="Remove"><i class="fas fa-times"></i></button></div>'}).join(""):n.innerHTML='<div style="color:var(--muted);text-align:center;padding:1rem">Queue is empty. Hashes are queued automatically when offline.</div>')}function Ie(){W(),fetch("/api/offline/queue").then(function(e){return e.json()}).then(function(e){if(e.queue_size>0){var a=document.getElementById("offlineQueueCount"),n=Q().length;a&&(a.textContent=n+e.queue_size)}if(e.last_sync){var i=document.getElementById("offlineLastSync");i&&(i.textContent=new Date(e.last_sync).toLocaleString())}}).catch(function(){})}var H=0,Y=5,_e=1e3;async function se(e){e=e||0;var a=Q(),n=a.filter(function(t){return!t.synced});if(!n.length){H=0,B("No pending hashes to sync.","info");return}if(!navigator.onLine){B("Cannot sync — currently offline.","warning");return}B("Syncing "+n.length+" hashes to XRPL"+(e>0?" (retry "+e+"/"+Y+")":"")+"...","info");try{var i=await le("/api/offline/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hashes:n})});if(!i.ok)throw new Error("Server returned "+i.status);for(var s=await i.json(),u=0;u<a.length;u++)a[u].synced||(a[u].synced=!0,a[u].synced_at=new Date().toISOString());ie(a),localStorage.setItem(ne,new Date().toISOString()),H=0,B("Sync complete: "+(s.synced||n.length)+" anchored.","success"),W()}catch(t){if(H=e+1,H<=Y){var m=_e*Math.pow(2,e)+Math.floor(Math.random()*500);B("Sync failed ("+t.message+"). Retrying in "+Math.round(m/1e3)+"s...","warning"),setTimeout(function(){se(H)},m)}else H=0,B("Sync failed after "+Y+" retries: "+t.message+". Try again later.","error")}}var le=window.fetch;window.fetch=function(e,a){if(!navigator.onLine&&typeof e=="string"){var n=e.indexOf("/api/anchor")!==-1||e.indexOf("/api/demo/anchor")!==-1,i=e.indexOf("/api/demo/provision")!==-1;if(n){try{var s=a&&a.body?JSON.parse(a.body):{},u=Q();u.push({hash:s.hash||s.data_hash||"UNKNOWN",record_type:s.record_type||"QUEUED_ANCHOR",branch:s.branch||"JOINT",timestamp:new Date().toISOString(),synced:!1}),ie(u),B("Offline: anchor queued locally. Will sync when reconnected.","info")}catch(r){console.warn("Offline queue error:",r)}return Promise.resolve(new Response(JSON.stringify({status:"queued_offline",message:"Hash queued for offline sync.",record:{tx_hash:"OFFLINE_"+Date.now().toString(36).toUpperCase(),network:"Queued Offline"}}),{status:200,headers:{"Content-Type":"application/json"}}))}if(i){var m=localStorage.getItem("s4_selected_tier")||"starter",t={pilot:{label:"Pilot",sls:100},starter:{label:"Starter",sls:25e3},professional:{label:"Professional",sls:1e5},enterprise:{label:"Enterprise",sls:5e5}},o=t[m]||t.starter;return Promise.resolve(new Response(JSON.stringify({session_id:"offline_"+Date.now(),subscription:{label:o.label,sls_allocation:o.sls},wallet:{address:"rOfflineMode"},xrp_balance:12,sls_balance:o.sls}),{status:200,headers:{"Content-Type":"application/json"}}))}}return le.apply(this,arguments)};window.addEventListener("online",function(){W(),B("Connection restored. Auto-syncing offline queue...","success"),setTimeout(function(){var e=Q(),a=e.filter(function(n){return!n.synced});a.length>0&&se()},2e3)});window.addEventListener("offline",function(){W(),B("Connection lost. Anchors will be queued locally.","warning")});function B(e,a){var n=document.querySelector(".workspace-notification");n&&n.remove();var i=document.createElement("div");i.className="workspace-notification";var s={success:"var(--green)",error:"var(--red)",warning:"var(--gold)",info:"var(--accent)"};i.style.borderColor=s[a]||s.info,i.innerHTML='<button class="notif-close" onclick="this.parentElement.remove()">&times;</button><i class="fas fa-'+(a==="success"?"check-circle":a==="error"?"times-circle":a==="warning"?"exclamation-triangle":"info-circle")+'" style="color:'+(s[a]||s.info)+';margin-right:6px"></i>'+e,document.body.appendChild(i),setTimeout(function(){i.remove()},5e3)}document.addEventListener("DOMContentLoaded",function(){W()});function ee(){var e=document.getElementById("gapRadarChart"),a=document.getElementById("gapBarChart");if(!(!e||!a)){var n=document.getElementById("gapChartsRow");n&&(n.style.display="flex");var i,s;typeof ilsResults<"u"&&ilsResults&&ilsResults.elements&&Object.keys(ilsResults.elements).length>0?(i=Object.keys(ilsResults.elements),s=i.map(function(m){return ilsResults.elements[m]&&typeof ilsResults.elements[m].score=="number"?ilsResults.elements[m].score:0})):(i=["Supply Support","Maintenance Planning","Tech Data","Training","Config Mgmt","DMSMS","PHS&T","Reliability","Support Equipment","Manpower"],s=[72,58,85,44,91,35,67,78,52,63]),e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"radar",data:{labels:i.map(function(m){return m.replace(/_/g," ").replace(/\b\w/g,function(t){return t.toUpperCase()})}),datasets:[{label:"ILS Element Coverage %",data:s,backgroundColor:"rgba(0,170,255,0.12)",borderColor:"#00aaff",borderWidth:2,pointBackgroundColor:"#00aaff",pointBorderColor:"#fff",pointRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{r:{min:0,max:100,ticks:{display:!1},grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:10}}}},plugins:{legend:{display:!1}}}});var u=s.map(function(m){return m>=80?"#00cc66":m>=50?"#ffa500":"#ff4444"});a.__chartInstance&&a.__chartInstance.destroy(),a.__chartInstance=new Chart(a,{type:"bar",data:{labels:i.map(function(m){return m.replace(/_/g," ").replace(/\b\w/g,function(t){return t.toUpperCase()})}),datasets:[{label:"Score",data:s,backgroundColor:u,borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{min:0,max:100,grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8"}},y:{ticks:{color:"#8ea4b8",font:{size:10}},grid:{display:!1}}},plugins:{legend:{display:!1}}}})}}function ce(){var e=document.getElementById("dmsmsPieChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"doughnut",data:{labels:["Active","At Risk","Obsolete","Resolved","Monitoring"],datasets:[{data:window._dmsmsChartData&&window._dmsmsChartData.reduce(function(a,n){return a+n},0)>0?window._dmsmsChartData:[45,18,12,20,5],backgroundColor:["#00cc66","#ffa500","#ff4444","#00aaff","#8ea4b8"],borderWidth:0,hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"55%",plugins:{legend:{position:"bottom",labels:{color:"#8ea4b8",padding:12,usePointStyle:!0,pointStyle:"circle",font:{size:11}}}}}}))}function de(){var e=document.getElementById("readinessGauge");if(e){var a=.87;if(typeof window._readinessAo=="number"&&!isNaN(window._readinessAo))a=window._readinessAo;else{var n=document.getElementById("readinessAo")||document.getElementById("statAo");if(n&&n.textContent&&n.textContent!=="—"){var i=parseFloat(n.textContent);isNaN(i)||(a=i>1?i/100:i)}}e.__chartInstance&&e.__chartInstance.destroy();var s=Math.round(a*100),u=Math.min(100,s+8),m=Math.min(100,s-3),t=Math.min(100,s-10),o=Math.min(100,s+12),r=Math.min(100,s+2),l=Math.min(100,s+5),c=[u,m,t,o,r,l].map(function(d){return d>=90?"rgba(0,204,102,0.7)":d>=75?"rgba(0,170,255,0.6)":d>=60?"rgba(255,165,0,0.6)":"rgba(255,68,68,0.6)"});e.__chartInstance=new Chart(e,{type:"bar",data:{labels:["Personnel","Equipment","Supply","Training","Maintenance","C4ISR"],datasets:[{label:"Readiness %",data:[u,m,t,o,r,l],backgroundColor:c,borderColor:c.map(function(d){return d.replace("0.7","1").replace("0.6","1")}),borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(d){return d.parsed.y+"%"}}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:11}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:10},callback:function(d){return d+"%"}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0,max:100}}}})}}function ue(){var e=document.getElementById("complianceRadarChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"radar",data:{labels:["CMMC L2","NIST 800-171","DFARS 7012","ITAR","FIPS 140-2","FedRAMP","IL4/IL5"],datasets:[{label:"Current Posture",data:window._complianceScores&&window._complianceScores.reduce(function(a,n){return a+n},0)>0?window._complianceScores:[78,85,92,88,70,65,82],backgroundColor:"rgba(0,170,255,0.12)",borderColor:"#00aaff",borderWidth:2,pointBackgroundColor:"#00aaff",pointRadius:4},{label:"Target",data:[95,95,100,100,90,85,95],backgroundColor:"rgba(201,168,76,0.06)",borderColor:"rgba(201,168,76,0.5)",borderWidth:1,borderDash:[4,4],pointRadius:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{r:{min:0,max:100,ticks:{display:!1},grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:10}}}},plugins:{legend:{labels:{color:"#8ea4b8",usePointStyle:!0,font:{size:11}}}}}}))}function fe(){var e=document.getElementById("roiLineChart");if(e){e.getAttribute("data-bp-rendered")&&e.removeAttribute("data-bp-rendered");var a=document.getElementById("hub-roi");if(a&&typeof Chart<"u"){var n=null;try{n=Chart.getChart(e)}catch{}if(n&&n.data&&n.data.labels&&n.data.labels.length>=20)return}if(e.__chartInstance)try{e.__chartInstance.destroy()}catch{}for(var i=parseFloat((document.getElementById("roiFTEs")||{}).value)||8,s=parseFloat((document.getElementById("roiRate")||{}).value)||145,u=parseFloat((document.getElementById("roiAudit")||{}).value)||25e4,m=parseFloat((document.getElementById("roiError")||{}).value)||8500,t=parseFloat((document.getElementById("roiIncidents")||{}).value)||35,o=parseFloat((document.getElementById("roiLicense")||{}).value)||12e4,r=i*2080*s*.65,l=t*m*.9,c=u*.7,d=r+l+c,f=[],h=["Q1","Q2","Q3","Q4","Q5","Q6","Q7","Q8","Q9","Q10","Q11","Q12","Q13","Q14","Q15","Q16","Q17","Q18","Q19","Q20"],v=1;v<=20;v++){var g=.2+.65*(1-Math.exp(-.18*v)),x=d/4*g,I=o/4,y=v>1?f[v-2]:0;f.push(Math.round(y+x-I))}e.__chartInstance=new Chart(e,{type:"line",data:{labels:h,datasets:[{label:"Cumulative ROI ($)",data:f,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.08)",fill:!0,tension:.3,borderWidth:2,pointBackgroundColor:"#00aaff",pointBorderColor:"#fff",pointRadius:5,pointHoverRadius:7},{label:"Break-Even Line",data:[0,0,0,0,0],borderColor:"rgba(255,255,255,0.2)",borderDash:[5,5],borderWidth:1,pointRadius:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8",callback:function(C){return"$"+(C/1e3).toFixed(0)+"K"}}},x:{grid:{display:!1},ticks:{color:"#8ea4b8"}}},plugins:{legend:{labels:{color:"#8ea4b8",usePointStyle:!0,font:{size:11}}}}}})}}function me(){var e=document.getElementById("riskHeatChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"bar",data:{labels:["Supply Chain","Cyber/Data","Obsolescence","Financial","Regulatory","Operational"],datasets:[{label:"Risk Score",data:window._riskChartScores&&window._riskChartScores.length===6?window._riskChartScores:[78,62,85,45,55,71],backgroundColor:function(a){var n=a.raw;return n>=75?"rgba(255,68,68,0.7)":n>=50?"rgba(255,165,0,0.7)":"rgba(0,204,102,0.7)"},borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{min:0,max:100,grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8"}},y:{ticks:{color:"#8ea4b8",font:{size:11}},grid:{display:!1}}},plugins:{legend:{display:!1}}}}))}function pe(){var e=document.getElementById("lifecyclePieChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"doughnut",data:{labels:["Acquisition","Sustainment (O&S)","DMSMS / Obsol.","Disposal","Personnel","Training"],datasets:[{data:window._lifecycleChartData&&window._lifecycleChartData.length===6?window._lifecycleChartData:[28,42,12,5,8,5],backgroundColor:["#00aaff","#c9a84c","#ff4444","#8ea4b8","#00cc66","#9b59b6"],borderWidth:0,hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"50%",plugins:{legend:{position:"bottom",labels:{color:"#8ea4b8",padding:12,usePointStyle:!0,pointStyle:"circle",font:{size:11}}}}}}))}function he(){var e={"hub-analysis":{target:"ilsResult",charts:'<div class="row mt-3" id="gapChartsRow"><div class="col-md-6"><div class="chart-container"><div class="chart-title"><i class="fas fa-chart-pie"></i> ILS Element Coverage</div><canvas id="gapRadarChart" height="240"></canvas></div></div><div class="col-md-6"><div class="chart-container"><div class="chart-title"><i class="fas fa-chart-bar"></i> Element Scores</div><canvas id="gapBarChart" height="240"></canvas></div></div></div>'},"hub-dmsms":{target:null,charts:'<div class="chart-container mt-3" id="dmsmsChartArea"><div class="chart-title"><i class="fas fa-chart-pie"></i> Obsolescence Risk Distribution</div><canvas id="dmsmsPieChart" height="200"></canvas></div>'},"hub-readiness":{target:null,charts:'<div class="chart-container mt-3" style="max-width:100%" id="readinessGaugeArea"><div class="chart-title"><i class="fas fa-gauge-high"></i> Operational Availability</div><canvas id="readinessGauge" height="300"></canvas></div>'},"hub-compliance":{target:null,charts:'<div class="chart-container mt-3" id="complianceChartArea"><div class="chart-title"><i class="fas fa-shield-halved"></i> Compliance Framework Radar</div><canvas id="complianceRadarChart" height="250"></canvas></div>'},"hub-roi":{target:null,charts:'<div class="chart-container mt-3" id="roiChartArea"><div class="chart-title"><i class="fas fa-chart-line"></i> ROI Projection — 5 Year Cumulative</div><canvas id="roiLineChart" height="220"></canvas></div>'},"hub-risk":{target:null,charts:'<div class="chart-container mt-3" id="riskChartArea"><div class="chart-title"><i class="fas fa-triangle-exclamation"></i> Risk Category Assessment</div><canvas id="riskHeatChart" height="220"></canvas></div>'},"hub-lifecycle":{target:null,charts:'<div class="chart-container mt-3" id="lifecycleChartArea"><div class="chart-title"><i class="fas fa-chart-pie"></i> Total Ownership Cost Breakdown</div><canvas id="lifecyclePieChart" height="220"></canvas></div>'}};Object.keys(e).forEach(function(a){var n=e[a],i=document.getElementById(a);if(i&&!i.getAttribute("data-charts-injected")){var s=n.charts.match(/id="([^"]+)"/);if(s&&document.getElementById(s[1])){i.setAttribute("data-charts-injected","1");return}var u=i.querySelector(".demo-card");if(u){if(n.target){var m=document.getElementById(n.target);if(m){var t=document.createElement("div");t.innerHTML=n.charts,m.parentNode.insertBefore(t.firstElementChild,m.nextSibling),i.setAttribute("data-charts-injected","1");return}}var t=document.createElement("div");t.innerHTML=n.charts,u.appendChild(t.firstElementChild),i.setAttribute("data-charts-injected","1")}}})}var Le=openILSTool;openILSTool=function(e){Le(e),he(),setTimeout(function(){e==="hub-analysis"&&ilsResults&&ee(),e==="hub-dmsms"&&ce(),e==="hub-readiness"&&de(),e==="hub-compliance"&&ue(),e==="hub-roi"&&fe(),e==="hub-risk"&&me(),e==="hub-lifecycle"&&pe()},300)};var Te=switchHubTab;switchHubTab=function(e,a){Te(e,a),he(),setTimeout(function(){e==="hub-analysis"&&typeof ilsResults<"u"&&ilsResults&&ee(),e==="hub-dmsms"&&ce(),e==="hub-readiness"&&de(),e==="hub-compliance"&&ue(),e==="hub-roi"&&fe(),e==="hub-risk"&&me(),e==="hub-lifecycle"&&pe()},300)};var te=null;typeof showILSResults=="function"&&(te=showILSResults,showILSResults=function(){te.apply(this,arguments);var e=document.getElementById("gapChartsRow");e&&(e.style.display="flex"),setTimeout(ee,500)});(function(){function e(i){var s=document.getElementById(i);if(!(!s||s.dataset.uxDone)){s.dataset.uxDone="1",s.querySelectorAll("details").forEach(function(p){p.removeAttribute("style")}),s.querySelectorAll("details summary").forEach(function(p){p.removeAttribute("style")}),s.querySelectorAll("details > div").forEach(function(p){p.removeAttribute("style")}),s.querySelectorAll("h3 > i[style], h4 > i[style]").forEach(function(p){p.removeAttribute("style")});var u=s.querySelectorAll(".demo-card");u.forEach(function(p){var S=p.querySelector("h3, h4");if(S){var w=S.nextElementSibling,_=p.querySelector(".hub-tool-header");_&&(w=_.nextElementSibling),w&&w.tagName==="P"&&w.getAttribute("style")&&w.removeAttribute("style")}}),s.querySelectorAll("button[style]").forEach(function(p){if(!(p.closest(".ils-dropzone")||p.closest(".post-actions")||p.closest(".post-action-btn"))&&p.style.display!=="none"){var S=p.textContent.toLowerCase(),w=S.includes("anchor")||S.includes("xrpl"),_=S.includes("export")||S.includes("download")||S.includes("generate"),b=S.includes("run ")||S.includes("analyze")||S.includes("calculate"),E=S.includes("clear")||S.includes("delete");E||(p.innerHTML,p.getAttribute("onclick"),w||b?(p.removeAttribute("style"),p.className="btn-anchor"):_&&(p.removeAttribute("style"),p.className="btn-export"))}}),s.querySelectorAll("div[style]").forEach(function(p){var S=p.getAttribute("style")||"";if(S.includes("display:flex")&&S.includes("gap:10")&&S.includes("flex-wrap:wrap")&&!p.classList.contains("ils-dropzone")&&!p.querySelector(".ils-dropzone")&&!p.closest(".post-actions")){var w=p.querySelectorAll("button");w.length>0&&(p.className="tool-actions-bar",p.removeAttribute("style"))}}),u.forEach(function(p){p.querySelectorAll(":scope > label, :scope > .row > .col-md-6 > label");var S=p.querySelector(":scope > label");if(S&&!S.previousElementSibling?.classList?.contains("section-label")){var w=document.createElement("div");w.className="section-label",w.innerHTML='<i class="fas fa-sliders"></i> CONFIGURATION';var _=document.createElement("hr");_.className="section-divider",S.parentNode.insertBefore(_,S),S.parentNode.insertBefore(w,_)}var b=p.querySelector('[id$="Results"], [id$="Output"], [id$="result"], [id$="Result"]');if(b&&!b.previousElementSibling?.classList?.contains("section-label")){var E=document.createElement("div");E.className="section-label",E.innerHTML='<i class="fas fa-chart-bar"></i> RESULTS';var T=document.createElement("hr");T.className="section-divider",b.parentNode.insertBefore(T,b),b.parentNode.insertBefore(E,T)}var R=p.querySelector(".tool-actions-bar");if(R&&!R.previousElementSibling?.classList?.contains("section-label")){var q=document.createElement("div");q.className="section-label",q.innerHTML='<i class="fas fa-bolt"></i> ACTIONS',R.parentNode.insertBefore(q,R)}});var m=s.querySelector(".demo-card");if(m){var t=i==="hub-analysis"||i==="hub-actions";if(!t){for(var o=m.querySelectorAll(":scope > .row"),r=null,l=0;l<o.length;l++){var c=o[l];if(c.querySelectorAll(".stat-mini").length>=3){r=c;break}}if(r){var d=m.querySelector(".hub-tool-header")||m.querySelector("h3, h4");if(d){var f=d;r.style.cssText="",r.classList.add("mb-3"),f.parentNode.insertBefore(r,f.nextSibling)}}}if(i==="hub-actions"){var h=m.querySelector(".col-lg-8");if(h){var v=h.querySelector(".demo-card");if(v){for(var g=null,x=v.querySelectorAll(":scope > .row"),I=0;I<x.length;I++)if(x[I].querySelectorAll(".stat-mini").length>=3){g=x[I];break}if(g){var y=v.querySelector("h3");y&&(g.style.cssText="",g.classList.add("mb-3"),y.parentNode.insertBefore(g,y.nextSibling))}}}}s.querySelectorAll("input[style], select[style]").forEach(function(p){p.type==="file"||p.type==="hidden"||p.style.display!=="none"&&p.removeAttribute("style")});var C=s.querySelectorAll(".chart-container");C.forEach(function(p){p.style.display="block"});var A=s.querySelector("#gapChartsRow");A&&(A.style.display="flex")}}}var a=openILSTool;openILSTool=function(i){a(i),setTimeout(function(){e(i)},100)};var n=switchHubTab;switchHubTab=function(i,s){n(i,s),setTimeout(function(){e(i)},100)},document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){document.querySelectorAll('.ils-hub-panel.active, .ils-hub-panel[style*="display:block"], .ils-hub-panel[style*="display: block"]').forEach(function(i){e(i.id)})},2500)})})();console.log("[Anchor-S4] Chart & KPI Enhancement Engine loaded");document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector('a[href="#tabILS"]');e&&e.addEventListener("shown.bs.tab",function(){updateAiContext(currentHubPanel||"hub-analysis")})});var M,F;(function(){var a=new Date;M=a.getFullYear(),F=a.getMonth()})();function J(){var e=document.getElementById("actionCalendarGrid"),a=document.getElementById("calMonthLabel");if(!(!e||!a)){if(typeof M>"u"||M===void 0||M===null){var n=new Date;M=n.getFullYear(),F=n.getMonth()}var i=["January","February","March","April","May","June","July","August","September","October","November","December"];a.textContent=i[F]+" "+M;var s=new Date(M,F,1).getDay(),u=new Date(M,F+1,0).getDate(),m=new Date,t=m.getFullYear()===M&&m.getMonth()===F,o={};try{var r=typeof s4ActionItems<"u"&&s4ActionItems.length>0?s4ActionItems:JSON.parse(localStorage.getItem("s4ActionItems")||"[]");r.forEach(function(y){var C=y.due||y.schedule||"";if(C){var A=new Date(C);if(!isNaN(A.getTime())&&A.getFullYear()===M&&A.getMonth()===F){var p=A.getDate();o[p]||(o[p]=[]),o[p].push(y)}}})}catch{}if(Object.keys(o).length===0){var l=[{day:3,title:"DMSMS Review — AN/SPS-49 Radar",severity:"critical"},{day:7,title:"ILS Gap Analysis — DDG-51 FY25",severity:"warning"},{day:10,title:"Parts Order Deadline — CVN-78",severity:"critical"},{day:12,title:"Compliance Audit Prep",severity:"info"},{day:15,title:"Warranty Expiry — GE LM2500",severity:"warning"},{day:18,title:"Lifecycle Cost Review",severity:"info"},{day:21,title:"Risk Assessment Update",severity:"warning"},{day:24,title:"Readiness Report Due",severity:"critical"},{day:27,title:"Obsolescence Check — MIL-STD-1553",severity:"info"}];l.forEach(function(y){y.day<=u&&(o[y.day]||(o[y.day]=[]),o[y.day].push(y))})}var c="";["Su","Mo","Tu","We","Th","Fr","Sa"].forEach(function(y){c+='<div style="padding:4px;font-weight:700;color:var(--steel);font-size:0.7rem">'+y+"</div>"});for(var d=0;d<s;d++)c+='<div style="padding:6px"></div>';for(var f=1;f<=u;f++){var h=t&&f===m.getDate(),v=o[f],g=h?"rgba(0,170,255,0.2)":v?"rgba(0,170,255,0.06)":"var(--surface)",x=h?"1px solid var(--accent)":v?"1px solid rgba(0,170,255,0.15)":"1px solid var(--border)",I="";v&&v.forEach(function(y){var C=y.severity==="critical"?"#ff3333":y.severity==="warning"?"#ffa500":"#00aaff";I+='<span style="display:inline-block;width:4px;height:4px;border-radius:50%;background:'+C+';margin:0 1px"></span>'}),c+='<div onclick="showCalDay('+f+')" style="padding:4px 2px;background:'+g+";border:"+x+";border-radius:4px;cursor:"+(v?"pointer":"default")+';min-height:32px"><div style="color:'+(h?"#00aaff":"#fff")+";font-weight:"+(h?"800":"400")+'">'+f+"</div>"+(I?'<div style="margin-top:2px">'+I+"</div>":"")+"</div>"}e.innerHTML=c}}function $(){var e=document.getElementById("actionCalendarGrid"),a=document.getElementById("calMonthLabel");if(!e||!a){setTimeout($,500);return}J(),(!e.innerHTML||e.innerHTML.trim()==="")&&setTimeout(J,300)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){setTimeout($,800)}):setTimeout($,800);(function(){var e=new MutationObserver(function(n){n.forEach(function(i){if(i.type==="attributes"&&i.attributeName==="style"){var s=i.target;s.id==="hub-actions"&&s.style.display!=="none"&&setTimeout(J,150)}})}),a=document.getElementById("hub-actions");a?e.observe(a,{attributes:!0,attributeFilter:["style"]}):document.addEventListener("DOMContentLoaded",function(){var n=document.getElementById("hub-actions");n&&e.observe(n,{attributes:!0,attributeFilter:["style"]})})})();(function(){var a="s4_demo_tool_card_order";function n(){return document.getElementById("ilsSubHub")}function i(){var m=n();if(m){var t=localStorage.getItem(a);if(t)try{var o=JSON.parse(t),r=Array.from(m.querySelectorAll(".ils-tool-card")),l={};r.forEach(function(c){var d=c.getAttribute("onclick")||"",f=(d.match(/openILSTool\('([^']+)'\)/)||[])[1];f&&(l[f]=c)}),o.forEach(function(c){l[c]&&m.appendChild(l[c])})}catch{}}}function s(){var m=n();if(m){var t=m.querySelectorAll(".ils-tool-card"),o=[];t.forEach(function(r){var l=r.getAttribute("onclick")||"",c=(l.match(/openILSTool\('([^']+)'\)/)||[])[1];c&&o.push(c)}),localStorage.setItem(a,JSON.stringify(o))}}function u(){var m=n();if(m){var t=null;m.querySelectorAll(".ils-tool-card").forEach(function(o){o.setAttribute("draggable","true"),o.addEventListener("dragstart",function(f){t=this,this.classList.add("dragging"),f.dataTransfer.effectAllowed="move",f.dataTransfer.setData("text/plain","")}),o.addEventListener("dragend",function(){this.classList.remove("dragging"),m.querySelectorAll(".ils-tool-card").forEach(function(f){f.classList.remove("drag-over")})}),o.addEventListener("dragover",function(f){f.preventDefault(),f.dataTransfer.dropEffect="move",this!==t&&this.classList.add("drag-over")}),o.addEventListener("dragleave",function(){this.classList.remove("drag-over")}),o.addEventListener("drop",function(f){if(f.preventDefault(),this.classList.remove("drag-over"),t&&t!==this){var h=Array.from(m.querySelectorAll(".ils-tool-card")),v=h.indexOf(t),g=h.indexOf(this);v<g?m.insertBefore(t,this.nextSibling):m.insertBefore(t,this),s(),u()}t=null});var r=null,l=!1,c=null,d=null;o.addEventListener("touchstart",function(f){var h=this;r=setTimeout(function(){l=!0,d=h,h.classList.add("dragging"),c=h.cloneNode(!0),c.style.position="fixed",c.style.pointerEvents="none",c.style.opacity="0.85",c.style.zIndex="9999",c.style.width=h.offsetWidth+"px",c.style.transform="scale(1.05)",c.style.boxShadow="0 8px 32px rgba(0,170,255,0.3)",document.body.appendChild(c)},500)},{passive:!0}),o.addEventListener("touchmove",function(f){if(!(!l||!c)){f.preventDefault();var h=f.touches[0];c.style.left=h.clientX-c.offsetWidth/2+"px",c.style.top=h.clientY-c.offsetHeight/2+"px",m.querySelectorAll(".ils-tool-card").forEach(function(x){x.classList.remove("drag-over")});var v=document.elementFromPoint(h.clientX,h.clientY);if(v){var g=v.closest(".ils-tool-card");g&&g!==d&&g.classList.add("drag-over")}}},{passive:!1}),o.addEventListener("touchend",function(f){if(clearTimeout(r),l&&d){var h=f.changedTouches[0],v=document.elementFromPoint(h.clientX,h.clientY),g=v?v.closest(".ils-tool-card"):null;if(g&&g!==d){var x=Array.from(m.querySelectorAll(".ils-tool-card")),I=x.indexOf(d),y=x.indexOf(g);I<y?m.insertBefore(d,g.nextSibling):m.insertBefore(d,g),s(),u()}d.classList.remove("dragging"),m.querySelectorAll(".ils-tool-card").forEach(function(C){C.classList.remove("drag-over")})}c&&c.parentNode&&c.parentNode.removeChild(c),l=!1,c=null,d=null}),o.addEventListener("touchcancel",function(){clearTimeout(r),c&&c.parentNode&&c.parentNode.removeChild(c),d&&d.classList.remove("dragging"),m.querySelectorAll(".ils-tool-card").forEach(function(f){f.classList.remove("drag-over")}),l=!1,c=null,d=null})})}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){i(),u()}):(i(),u())})();function ke(){var e=document.getElementById("slsBarBalance"),a=document.getElementById("walletTriggerBal");e&&a&&(a.textContent=e.textContent||"--")}document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){var e=document.getElementById("platformHub");e&&(e.style.display="block"),document.querySelectorAll(".tab-pane").forEach(function(n){n.classList.remove("show","active"),n.style.display="none"});var a=document.getElementById("demoPanel");a&&(a.style.display="none")},100)});document.addEventListener("shown.bs.tab",function(e){ke()});(function(){function e(){var a=document.getElementById("actionItemBadge");if(a){var n=0;typeof s4ActionItems<"u"&&Array.isArray(s4ActionItems)&&(n=s4ActionItems.filter(function(i){return!i.done}).length),n>0?(a.textContent=n,a.style.display="inline-flex"):a.style.display="none"}}setInterval(e,3e3),document.addEventListener("DOMContentLoaded",function(){setTimeout(e,2e3)})})();(function(){function e(){var a=document.getElementById("slsBarBalance"),n=document.getElementById("slsBarAnchors"),i=document.getElementById("slsBarSpent"),s=document.getElementById("toolSlsBal"),u=document.getElementById("toolSlsAnch"),m=document.getElementById("toolSlsSpent");s&&a&&(s.textContent=a.textContent.replace(" SLS","")),u&&n&&(u.textContent=n.textContent),m&&i&&(m.textContent=i.textContent.replace(" SLS",""))}setInterval(e,2e3)})();(function(){var e=hideAnchorAnimation;hideAnchorAnimation=function(){e()}})();var N={ils_manager:{label:"ILS Manager",icon:"fa-clipboard-list",desc:"Full ILS tool suite access",tabs:["hub-analysis","hub-dmsms","hub-readiness","hub-compliance","hub-risk","hub-actions","hub-predictive","hub-lifecycle","hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-sbom","hub-gfp","hub-cdrl","hub-contract","hub-provenance","hub-analytics","hub-team"]},dmsms_analyst:{label:"DMSMS Analyst",icon:"fa-microchip",desc:"DMSMS tracking and obsolescence management",tabs:["hub-dmsms","hub-risk","hub-lifecycle","hub-actions","hub-vault","hub-docs","hub-reports"]},auditor:{label:"Auditor / Compliance",icon:"fa-shield-halved",desc:"Compliance scorecard and audit vault",tabs:["hub-compliance","hub-vault","hub-actions","hub-docs","hub-reports","hub-submissions"]},contracts:{label:"Contract Specialist",icon:"fa-file-contract",desc:"ROI, submissions, and document management",tabs:["hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-actions","hub-cdrl","hub-contract"]},supply_chain:{label:"Supply Chain / Provisioning",icon:"fa-truck",desc:"Supply, readiness, and provisioning tools",tabs:["hub-readiness","hub-risk","hub-lifecycle","hub-actions","hub-vault","hub-docs","hub-submissions"]},admin:{label:"Full Access Admin",icon:"fa-user-shield",desc:"All tools visible — unrestricted access",tabs:["hub-analysis","hub-dmsms","hub-readiness","hub-compliance","hub-risk","hub-actions","hub-predictive","hub-lifecycle","hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-sbom","hub-gfp","hub-cdrl","hub-contract","hub-provenance","hub-analytics","hub-team"]}},ve=["hub-analysis","hub-dmsms","hub-readiness","hub-compliance","hub-risk","hub-actions","hub-predictive","hub-lifecycle","hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-sbom","hub-gfp","hub-cdrl","hub-contract","hub-provenance","hub-analytics","hub-team"],Me={"hub-analysis":"Gap Analysis","hub-dmsms":"DMSMS Tracker","hub-readiness":"Readiness Calc","hub-compliance":"Compliance","hub-risk":"Supply Chain Risk","hub-actions":"Action Items","hub-predictive":"Predictive Maint","hub-lifecycle":"Lifecycle Cost","hub-roi":"ROI Calculator","hub-vault":"Audit Vault","hub-docs":"Document Library","hub-reports":"Report Gen","hub-submissions":"Submissions & PTD","hub-sbom":"SBOM Viewer","hub-gfp":"GFP Tracker","hub-cdrl":"CDRL Validator","hub-contract":"Contract Extractor","hub-provenance":"Provenance Chain","hub-analytics":"Cross-Program Analytics","hub-team":"Team Management"},k=sessionStorage.getItem("s4_user_role")||"",ge=sessionStorage.getItem("s4_user_title")||"",X=JSON.parse(sessionStorage.getItem("s4_visible_tabs")||"null");function be(){var e=document.createElement("div");e.id="roleModal",e.style.cssText="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:10000;display:flex;align-items:center;justify-content:center;animation:fadeIn 0.3s ease";var a='<div style="background:var(--card);border:1px solid var(--border);border-radius:3px;padding:32px;max-width:620px;width:95%;max-height:85vh;overflow-y:auto"><h3 style="color:#fff;margin:0 0 4px"><i class="fas fa-user-cog" style="color:var(--accent);margin-right:8px"></i>Configure Your Role</h3><p style="color:var(--steel);font-size:0.85rem;margin-bottom:20px">Select your role to see relevant tools. You can customize visible tools and your displayed title.</p><div style="margin-bottom:16px"><label style="color:var(--steel);font-size:0.8rem;font-weight:600">Your Display Title</label><input id="roleTitle" value="'+(ge||"")+'" style="background:#0a0e1a;color:#fff;border:1px solid rgba(255,255,255,0.15);border-radius:3px;padding:10px;width:100%;margin-top:4px" placeholder="e.g., ILS Analyst, Logistics Specialist, Contract Manager"></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px">';Object.keys(N).forEach(function(n){var i=N[n],s=k===n?"border-color:var(--accent);background:rgba(0,170,255,0.08)":"";a+=`<div class="role-card" onclick="selectRolePreset('`+n+`')" style="border:2px solid `+(s?"var(--accent)":"var(--border)")+";border-radius:3px;padding:14px;cursor:pointer;transition:all 0.2s;"+(s?"background:rgba(0,170,255,0.08)":"")+'" data-role="'+n+'"><div style="display:flex;align-items:center;gap:8px;margin-bottom:6px"><i class="fas '+i.icon+'" style="color:var(--accent);font-size:1.1rem"></i><strong style="color:#fff;font-size:0.9rem">'+i.label+'</strong></div><div style="color:var(--steel);font-size:0.78rem">'+i.desc+'</div><div style="color:var(--muted);font-size:0.72rem;margin-top:4px">'+i.tabs.length+" tools</div></div>"}),a+='</div><details style="margin-bottom:20px;background:rgba(0,170,255,0.03);border:1px solid rgba(0,170,255,0.12);border-radius:3px;padding:0 16px"><summary style="cursor:pointer;color:var(--accent);font-weight:600;font-size:0.85rem;padding:12px 0;list-style:none;display:flex;align-items:center;gap:8px"><i class="fas fa-sliders-h"></i> Customize Visible Tools <i class="fas fa-chevron-down" style="font-size:0.7rem;margin-left:auto;opacity:0.5"></i></summary><div id="roleToolChecks" style="display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:0 0 16px">',ve.forEach(function(n){var i=X?X.indexOf(n)>=0:k?(N[k]?.tabs||[]).indexOf(n)>=0:!0;a+='<label style="display:flex;align-items:center;gap:8px;font-size:0.82rem;color:var(--steel);cursor:pointer;padding:6px 10px;border-radius:3px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);transition:all 0.2s"><input type="checkbox" data-tab="'+n+'" '+(i?"checked":"")+' onchange="onRoleToolToggle()" style="accent-color:#00aaff;width:16px;height:16px;flex-shrink:0"> <span>'+(Me[n]||n)+"</span></label>"}),a+=`</div></details><div style="display:flex;gap:10px;justify-content:flex-end"><button onclick="document.getElementById('roleModal').remove()" style="background:rgba(255,255,255,0.06);color:var(--steel);border:1px solid var(--border);border-radius:3px;padding:8px 20px;cursor:pointer">Cancel</button><button onclick="applyRole()" style="background:var(--accent);color:#fff;border:none;border-radius:3px;padding:8px 24px;cursor:pointer;font-weight:600">Apply Role</button></div></div>`,e.innerHTML=a,document.body.appendChild(e)}function Re(e){document.querySelectorAll(".ils-hub-tab").forEach(function(a){var n=a.getAttribute("onclick")||"",i=n.match(/switchHubTab\('([^']+)'/);if(i){var s=i[1];a.style.display=e.indexOf(s)>=0?"":"none"}}),document.querySelectorAll(".ils-tool-card[onclick]").forEach(function(a){var n=a.getAttribute("onclick")||"",i=n.match(/openILSTool\('([^']+)'/);i&&(a.style.display=e.indexOf(i[1])>=0?"":"none")})}function Be(){var e=document.getElementById("roleBadge");if(!e){var a=document.querySelector(".ils-hub-tabs")?.previousElementSibling;if(!a)return;var n=a.querySelector("div:last-child");if(!n)return;e=document.createElement("span"),e.id="roleBadge",e.style.cssText="display:inline-flex;align-items:center;gap:6px;padding:5px 12px;border-radius:3px;font-size:0.75rem;font-weight:600;background:rgba(0,170,255,0.1);border:1px solid rgba(0,170,255,0.25);color:#00aaff;cursor:pointer;transition:all 0.2s;hover:background:rgba(0,170,255,0.2)",e.title="Click to change your role",e.onclick=be,n.appendChild(e)}var i=k?N[k]?.icon||"fa-user":"fa-user-cog",s=ge||(k?N[k]?.label:"Set Role");e.innerHTML='<i class="fas '+i+'"></i> '+s+' <i class="fas fa-gear" style="font-size:0.6rem;opacity:0.6"></i>'}function ae(){if(k){var e=X||(N[k]?N[k].tabs:ve);Re(e),typeof reloadVaultForRole=="function"&&reloadVaultForRole()}Be(),k||setTimeout(function(){var a=document.getElementById("platformWorkspace");a&&a.style.display==="block"&&sessionStorage.getItem("s4_onboard_done")&&be()},2500)}(function(){function e(t){return Math.round(t).toString().replace(/\B(?=(?:\d{3})+(?!\d))/g,",")}function a(){try{var t=function(L){var O=document.getElementById(L);return O&&parseFloat(O.value)||0},o=t("roiPrograms"),r=t("roiRecords"),l=t("roiFTEs"),c=t("roiRate"),d=t("roiAudit"),f=t("roiError"),h=t("roiIncidents"),v=t("roiLicense"),g=o*r,x=1+Math.sqrt(Math.max(0,g))/50,I=l*2080,y=I*c,C=y*.65*x,A=h*f*.9,p=d*.7*Math.max(1,o/5),S=g>0?C/12/g:0,w=C+A+p,_=w-v,b=v>0?_/v*100:0,E=w>0?Math.ceil(v/w*12):0,T=w*5-v*5,R=function(L,O,D){var V=document.getElementById(L);V&&(V.textContent=O,D&&(V.style.color=D))};R("roiSavings","$"+e(_),_>0?"#00cc66":"#ff4444"),R("roiPercent",b.toFixed(0)+"%",b>0?"#00cc66":"#ff4444"),R("roiPayback",E+" mo",null),R("roi5Year","$"+e(T),T>0?"#00cc66":"#ff4444");var q=document.getElementById("roiOutput");q&&(q.innerHTML='<div style="background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:20px;margin-top:12px"><div class="section-label"><i class="fas fa-chart-line"></i> ROI BREAKDOWN</div><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:0.85rem;margin-bottom:16px"><div><span style="color:var(--steel)">Labor Automation (65%)</span><br><strong style="color:#00cc66">$'+e(C)+'</strong></div><div><span style="color:var(--steel)">Error Reduction (90%)</span><br><strong style="color:#00cc66">$'+e(A)+'</strong></div><div><span style="color:var(--steel)">Audit Cost Reduction (70%)</span><br><strong style="color:#00cc66">$'+e(p)+'</strong></div><div><span style="color:var(--steel)">S4 Ledger License</span><br><strong style="color:#ff6b6b">-$'+e(v)+'</strong></div></div><hr style="border-color:var(--border);margin:12px 0"><div style="display:flex;justify-content:space-between;align-items:center"><div><span style="color:var(--steel);font-size:0.82rem">Net Annual Savings</span><br><span style="font-size:1.5rem;font-weight:800;color:'+(_>0?"#00cc66":"#ff4444")+'">$'+e(_)+'</span></div><div><span style="color:var(--steel);font-size:0.82rem">Per-Record Savings</span><br><span style="font-size:1.1rem;font-weight:700;color:var(--accent)">$'+S.toFixed(2)+'/record</span></div><div><span style="color:var(--steel);font-size:0.82rem">Volume Multiplier</span><br><span style="font-size:1.1rem;font-weight:700;color:var(--accent)">'+x.toFixed(2)+"x</span></div></div></div>");try{typeof renderROICharts=="function"&&renderROICharts()}catch{}}catch(L){console.error("[S4-BP-ROI] Error:",L)}}function n(){var t=["roiPrograms","roiRecords","roiFTEs","roiRate","roiAudit","roiError","roiIncidents","roiLicense"],o=0;return t.forEach(function(r){var l=document.getElementById(r);l&&(l.removeAttribute("oninput"),l.addEventListener("input",a),o++)}),o>0&&a(),o}function i(){var t={};try{var o=document.querySelectorAll('#ilsCoverage input[type="checkbox"], .ils-checklist input[type="checkbox"]'),r=0,l=o.length||1;o.forEach(function(f){f.checked&&r++}),t.ilsPct=Math.round(r/l*100)}catch{t.ilsPct=0}var c=["pctCMMC","pctNIST","pctDFARS","pctFAR","pctILS","pctDMSMSmgmt"];t.comp=c.map(function(f){var h=document.getElementById(f);return h&&parseInt(h.textContent)||0}),t.vault=typeof s4Vault<"u"?s4Vault.length:typeof getLocalRecords=="function"?getLocalRecords().length:0,t.actions=typeof s4ActionItems<"u"?s4ActionItems.length:0,t.actionsDone=0,typeof s4ActionItems<"u"&&s4ActionItems.forEach(function(f){f.status==="done"&&t.actionsDone++});var d=function(f){var h=document.getElementById(f);return h&&parseFloat(h.value)||0};return t.roiPrograms=d("roiPrograms"),t.roiRecords=d("roiRecords"),t.roiFTEs=d("roiFTEs"),t.roiRate=d("roiRate"),t.roiLicense=d("roiLicense"),t.roiAudit=d("roiAudit"),t.stats=typeof stats<"u"?stats:{anchored:0,slsFees:0},t.dmsmsItems=typeof dmsmsItems<"u"?dmsmsItems:[],t.riskItems=typeof riskItems<"u"?riskItems:[],t}var s={gapRadarChart:function(){var t=i(),o=Math.min(100,20+t.vault*3),r=Math.min(100,15+t.vault*4),l=Math.min(100,t.comp[0]||10),c=Math.min(100,10+(t.dmsmsItems.length||0)*8),d=Math.min(100,15+(t.riskItems.length||0)*5),f=Math.min(100,20+t.ilsPct*.6),h=[o,r,l,c,d,f].map(function(v){return Math.min(100,v+30+Math.random()*5|0)});return{type:"radar",data:{labels:["Tracking","Audit","Compliance","Obsolescence","Risk","Budget"],datasets:[{label:"Current (Manual)",data:[o,r,l,c,d,f],borderColor:"#ff6b6b",backgroundColor:"rgba(255,107,107,0.1)",pointBackgroundColor:"#ff6b6b"},{label:"With S4 Ledger",data:h,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#8ea4b8",font:{size:10}}}},scales:{r:{grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:9}},ticks:{display:!1}}}}}},gapBarChart:function(){var t=i(),o=Math.max(0,100-(20+t.vault*3)),r=Math.max(0,100-(15+t.vault*4)),l=Math.max(0,100-(t.comp[0]||10)),c=Math.max(0,100-(10+(t.dmsmsItems.length||0)*8)),d=Math.max(0,100-(15+(t.riskItems.length||0)*5)),f=Math.max(0,100-(20+t.ilsPct*.6));return{type:"bar",data:{labels:["Tracking","Audit","Compliance","Obsolescence","Risk","Budget"],datasets:[{label:"Gap %",data:[o,r,l,c,d,f],backgroundColor:["#ff6b6b","#fb923c","#c9a84c","#00aaff","#38bdf8","#06b6d4"],borderWidth:0,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},max:100},y:{ticks:{color:"#8ea4b8",font:{size:9}},grid:{display:!1}}}}}},dmsmsPieChart:function(){var t=i(),o=t.dmsmsItems,r=0,l=0,c=0,d=0,f=0;return o.length>0?o.forEach(function(h){var v=(h.status||"").toLowerCase();v.indexOf("obsolete")>=0?c++:v.indexOf("risk")>=0||v.indexOf("diminish")>=0?l++:v.indexOf("discontin")>=0?d++:v.indexOf("eol")>=0||v.indexOf("last")>=0?f++:r++}):(r=45,l=20,c=15,d=10,f=10),{type:"doughnut",data:{labels:["Active","At Risk","Obsolete","Discontinued","EOL Planned"],datasets:[{data:[r,l,c,d,f],backgroundColor:["#00aaff","#c9a84c","#ff6b6b","#00aaff","#6b7d93"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:9},padding:6}}}}}},readinessGauge:function(){var t=i(),o=Math.max(30,t.ilsPct),r=Math.min(100,o+15+(t.vault>5?10:0)),l=Math.min(100,o+(t.dmsmsItems.length>0?-5:8)),c=Math.min(100,o-12+t.vault*2),d=Math.min(100,o+20),f=Math.min(100,o+6+t.actionsDone*3),h=Math.min(100,o+12);return{type:"bar",data:{labels:["Personnel","Equipment","Supply","Training","Maintenance","C4ISR"],datasets:[{label:"Readiness %",data:[r,l,c,d,f,h],backgroundColor:"rgba(0,170,255,0.6)",borderColor:"#00aaff",borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:9}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0,max:100}}}}},complianceRadarChart:function(){var t=i(),o=t.comp[2]||30,r=Math.min(100,40+t.vault*4),l=t.comp[1]||25,c=t.comp[0]||20,d=Math.min(100,30+t.ilsPct*.5),f=Math.min(100,35+t.vault*3);return{type:"polarArea",data:{labels:["DFARS","ITAR","NIST 800-171","CMMC","ISO 27001","SOX"],datasets:[{data:[o,r,l,c,d,f],backgroundColor:["rgba(0,170,255,0.5)","rgba(201,168,76,0.5)","rgba(56,189,248,0.5)","rgba(255,107,107,0.5)","rgba(0,170,255,0.5)","rgba(6,182,212,0.5)"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:9},padding:6}}},scales:{r:{grid:{color:"rgba(255,255,255,0.06)"},ticks:{display:!1}}}}}},roiLineChart:function(){var t=i(),o=t.roiPrograms*t.roiRecords,r=1+Math.sqrt(Math.max(0,o))/50,l=t.roiFTEs*2080*t.roiRate,c=l*.65*r,d=t.roiAudit*.7*Math.max(1,t.roiPrograms/5),f=c+d,h=t.roiLicense||1,v=[],g=[],x=t.roiPrograms>0||t.roiFTEs>0||t.roiLicense>0;if(x)for(var I=0,y=1;y<=5;y++)for(var C=1;C<=4;C++){v.push("Y"+y+"-Q"+C);var A=(y-1)*4+C,p=.2+.65*(1-Math.exp(-.18*A)),S=f/4*p,w=h/4;I+=S-w;var _=h>0?I/h*100:0;g.push(Math.round(_))}if(!x||g.length===0||g.every(function(T){return T===0})){v=[],g=[];for(var b=1;b<=5;b++)for(var E=1;E<=4;E++){v.push("Y"+b+"-Q"+E);var A=(b-1)*4+E;g.push(Math.round(-15+3.5*A+.8*Math.pow(A,1.45)))}}return{type:"line",data:{labels:v,datasets:[{label:"Cumulative ROI %",data:g,borderColor:"#00cc66",backgroundColor:"rgba(0,204,102,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00cc66"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"5-Year Cumulative ROI",color:"#8ea4b8",font:{size:11}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:8},maxRotation:45},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:9},callback:function(T){return T+"%"}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}}},riskHeatChart:function(){var t=i(),o=[];if(t.riskItems.length>0)t.riskItems.forEach(function(d){o.push({x:d.likelihood||Math.ceil(Math.random()*9),y:d.impact||Math.ceil(Math.random()*9)})});else for(var r=Math.max(3,Math.min(12,3+t.vault+t.actions)),l=0;l<r;l++)o.push({x:1+Math.floor(Math.random()*9),y:1+Math.floor(Math.random()*9)});var c=o.map(function(d){var f=d.x*d.y;return f>=50?"rgba(255,70,70,0.8)":f>=25?"rgba(255,165,0,0.7)":f>=10?"rgba(201,168,76,0.6)":"rgba(0,170,255,0.5)"});return{type:"scatter",data:{datasets:[{label:"Risk Items",data:o,backgroundColor:c,borderColor:c,pointRadius:7}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:o.length+" Risk Items Mapped",color:"#8ea4b8",font:{size:11}}},scales:{x:{title:{display:!0,text:"Likelihood →",color:"#8ea4b8",font:{size:9}},ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},min:0,max:10},y:{title:{display:!0,text:"Impact →",color:"#8ea4b8",font:{size:9}},ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},min:0,max:10}}}}},lifecyclePieChart:function(){var t=i(),o=Math.min(30,(t.dmsmsItems.length||0)*5),r=Math.min(15,t.ilsPct*.15);return{type:"line",data:{labels:["Intro","Growth","Maturity","Sustain","Phase Out","Disposal"],datasets:[{label:"Availability %",data:[95-o*.1,92-o*.2+r,88-o*.4+r,75-o*.6+r*2,50-o*.3+r,20+r*.5].map(function(l){return Math.round(Math.max(5,Math.min(100,l)))}),borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3},{label:"Cost Index",data:[30,25+o*.3,35+o*.5,55+o*.8-r,70+o-r*2,90+o*.5-r].map(function(l){return Math.round(Math.max(5,Math.min(100,l)))}),borderColor:"#ff6b6b",backgroundColor:"rgba(255,107,107,0.05)",fill:!0,tension:.3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#8ea4b8",font:{size:10}}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:9}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}}}};window._bpRenderInPanel=u;function u(t){if(typeof Chart>"u"){console.warn("[S4-BP-Charts] Chart.js not loaded");return}if(typeof injectChartContainers=="function")try{injectChartContainers()}catch(r){console.error("[S4-BP-Charts] injectChartContainers error:",r)}var o=t.querySelectorAll("canvas");if(o.length===0){console.log("[S4-BP-Charts] No canvases found in panel "+t.id);return}o.forEach(function(r){if(!r.getAttribute("data-bp-rendered")){var l=s[r.id];if(!l){console.log("[S4-BP-Charts] No config for canvas: "+r.id);return}try{var c=Chart.getChart(r);c&&c.destroy(),!r.style.height&&!r.getAttribute("height")&&(r.style.height="220px"),r.style.width="100%",r.style.display="block";var d=r.closest(".chart-container");d&&(d.style.display="block",d.style.visibility="visible"),new Chart(r,l()),r.setAttribute("data-bp-rendered","1"),r.setAttribute("data-bp-ts",Date.now()),console.log("[S4-BP-Charts] Rendered: "+r.id)}catch(f){console.error("[S4-BP-Charts] Failed "+r.id+":",f)}}})}function m(){if(console.log("[S4-Bulletproof-v5] Initializing..."),n()===0&&(setTimeout(n,2e3),setTimeout(n,5e3)),window.calcROI=a,typeof window.openILSTool=="function"){var t=window.openILSTool;window.openILSTool=function(r){t(r),setTimeout(function(){var l=document.getElementById(r);l&&u(l)},300),setTimeout(function(){var l=document.getElementById(r);l&&u(l)},800),setTimeout(function(){var l=document.getElementById(r);l&&u(l)},2e3)},console.log("[S4-Bulletproof-v5] Hooked openILSTool")}if(typeof window.switchHubTab=="function"){var o=window.switchHubTab;window.switchHubTab=function(r,l){o(r,l),setTimeout(function(){var c=document.getElementById(r);c&&u(c)},400)}}document.querySelectorAll(".ils-hub-panel").forEach(function(r){var l=new MutationObserver(function(c){c.forEach(function(d){d.target.classList&&d.target.classList.contains("active")&&setTimeout(function(){u(d.target)},400)})});l.observe(r,{attributes:!0,attributeFilter:["class","style"]})}),setTimeout(function(){document.querySelectorAll(".ils-hub-panel.active").forEach(function(r){u(r)})},2e3),setTimeout(function(){if(typeof loadPerformanceMetrics=="function")try{loadPerformanceMetrics()}catch{}},1500),setTimeout(n,3e3),typeof ae=="function"&&ae(),console.log("[S4-Bulletproof-v5] Init complete")}window._s4RefreshCharts=function(){document.querySelectorAll("canvas[data-bp-rendered]").forEach(function(o){o.removeAttribute("data-bp-rendered")});var t=document.querySelector(".ils-hub-panel.active");t&&u(t)},document.readyState==="loading"?document.addEventListener("DOMContentLoaded",m):m()})();
//# sourceMappingURL=index-CLFNuOL3.js.map
