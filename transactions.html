<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <title>S4 Ledger | Live XRPL Transactions</title>
    <meta name="description" content="Real-time anchored defense logistics record hashes on the XRP Ledger — browse transactions across all military branches.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/s4-assets/style.css">
<style>
        .live-indicator{display:inline-flex;align-items:center;gap:10px;background:rgba(0,170,255,0.1);padding:10px 20px;border-radius:30px;font-size:0.9rem;font-weight:600;color:var(--accent);border:1px solid rgba(0,170,255,0.3);animation:indicatorGlow 2s ease-in-out infinite}
        @keyframes indicatorGlow{0%,100%{box-shadow:0 0 10px rgba(0,170,255,0.2)}50%{box-shadow:0 0 25px rgba(0,170,255,0.4)}}
        .live-dot{width:10px;height:10px;background:var(--accent);border-radius:50%;box-shadow:0 0 10px var(--accent);animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
        .stat-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;margin-bottom:24px}
        .stat-box{background:linear-gradient(135deg,rgba(0,170,255,0.08),rgba(26,58,92,0.15));border:1px solid rgba(0,170,255,0.2);border-radius:16px;padding:20px;text-align:center;transition:all 0.3s}
        .stat-box:hover{transform:translateY(-3px);border-color:rgba(0,170,255,0.5)}
        .stat-value{font-size:2rem;font-weight:800;background:linear-gradient(135deg,#00aaff,#c9a84c);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .stat-label{font-size:0.82rem;color:var(--text-secondary);margin-top:4px;font-weight:500}
        .filter-bar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:20px}
        .filter-select{background:rgba(0,170,255,0.08);color:#fff;border:1px solid rgba(0,170,255,0.25);border-radius:10px;padding:8px 14px;font-weight:500;cursor:pointer;font-family:inherit;font-size:0.85rem}
        .filter-select:focus{outline:none;border-color:var(--accent)}
        .filter-select option,.filter-select optgroup{background:#0a0a0f}
        .search-input{background:rgba(0,170,255,0.08);color:#fff;border:1px solid rgba(0,170,255,0.25);border-radius:10px;padding:8px 14px;font-family:inherit;font-size:0.85rem;flex:1;min-width:200px}
        .search-input:focus{outline:none;border-color:var(--accent)}
        .search-input::placeholder{color:var(--text-muted)}
        .tx-table-wrap{border:1px solid rgba(0,170,255,0.15);border-radius:12px;overflow:hidden}
        .tx-table{width:100%;border-collapse:collapse}
        .tx-table thead{background:rgba(0,170,255,0.06);position:sticky;top:0;z-index:1}
        .tx-table th{padding:14px 12px;font-size:0.8rem;text-transform:uppercase;letter-spacing:0.5px;color:var(--accent);font-weight:700;text-align:left;border-bottom:2px solid rgba(0,170,255,0.2)}
        .tx-table td{padding:12px;border-bottom:1px solid rgba(255,255,255,0.04);font-size:0.88rem;color:var(--text-secondary);transition:background 0.2s}
        .tx-table tr:hover td{background:rgba(0,170,255,0.03)}
        .tx-hash{font-family:'Monaco','Menlo',monospace;font-size:0.78rem;color:var(--accent);cursor:pointer;transition:color 0.2s}
        .tx-hash:hover{color:#fff;text-decoration:underline}
        .branch-badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:6px;font-size:0.75rem;font-weight:600;white-space:nowrap}
        .type-badge{background:rgba(0,170,255,0.12);color:var(--accent);padding:4px 10px;border-radius:6px;font-size:0.75rem;font-weight:600;white-space:nowrap}
        .fee-badge{color:#c9a84c;font-weight:700;font-family:monospace}
        .explorer-link{color:var(--accent);text-decoration:none;font-size:0.8rem;transition:color 0.2s}
        .explorer-link:hover{color:#fff}
        .pagination-bar{display:flex;justify-content:center;align-items:center;gap:12px;margin-top:20px;padding:16px 0}
        .page-btn{background:rgba(0,170,255,0.08);color:var(--accent);border:1px solid rgba(0,170,255,0.25);border-radius:8px;padding:8px 16px;cursor:pointer;font-weight:600;font-size:0.85rem;transition:all 0.2s;font-family:inherit}
        .page-btn:hover:not(:disabled){background:rgba(0,170,255,0.15);transform:translateY(-1px)}
        .page-btn:disabled{opacity:0.3;cursor:not-allowed}
        .page-info{color:var(--text-muted);font-size:0.85rem}
        .export-btn{background:rgba(201,168,76,0.1);color:var(--gold);border:1px solid rgba(201,168,76,0.3);border-radius:10px;padding:8px 18px;cursor:pointer;font-weight:600;font-size:0.85rem;transition:all 0.3s;display:inline-flex;align-items:center;gap:6px;font-family:inherit}
        .export-btn:hover{background:rgba(201,168,76,0.2);transform:translateY(-2px)}
        .no-data{text-align:center;padding:40px 20px;color:var(--text-muted);font-size:1rem}
        .scroll-container{max-height:700px;overflow-y:auto}
        @media(max-width:768px){.stat-value{font-size:1.4rem}.tx-table{font-size:0.82rem}.tx-table th,.tx-table td{padding:8px 6px}}
    </style>
</head>
<body>
<div class="mesh-bg"><div class="gradient-orb orb-1"></div><div class="gradient-orb orb-2"></div><div class="gradient-orb orb-3"></div></div>
<!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg">
    <div class="container">
        <a class="navbar-brand" href="/">
            <img src="/s4-assets/S4Ledger_logo.png" alt="S4" class="nav-logo">
            <span class="brand-text">S4 Ledger</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navContent">
            <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navContent">
            <ul class="navbar-nav align-items-center gap-1">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">Company</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/s4-about/"><i class="fas fa-building dd-accent"></i> About</a></li>
                        <li><a class="dropdown-item" href="/s4-investors/"><i class="fas fa-chart-line dd-accent"></i> Investors</a></li>
                        <li><a class="dropdown-item" href="/s4-partners/"><i class="fas fa-handshake dd-accent"></i> Partners</a></li>
                        <li><a class="dropdown-item" href="/s4-contact/"><i class="fas fa-envelope dd-accent"></i> Contact</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle active" href="#" data-bs-toggle="dropdown">Products</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/demo-app/"><i class="fas fa-terminal dd-green"></i> ILS Workspace</a></li>
                        <li><a class="dropdown-item" href="/sdk-playground/"><i class="fas fa-code dd-gold"></i> SDK Playground</a></li>
                        <li><a class="dropdown-item" href="/sdk/"><i class="fas fa-book dd-gold"></i> SDK Docs</a></li>
                        <li><a class="dropdown-item" href="/s4-marketplace/"><i class="fas fa-store dd-purple"></i> Marketplace</a></li>
                        <li><a class="dropdown-item" href="/metrics.html"><i class="fas fa-chart-bar dd-accent"></i> Metrics</a></li>
                        <li><a class="dropdown-item" href="/transactions.html"><i class="fas fa-exchange-alt dd-accent"></i> Transactions</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">More</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/s4-use-cases/"><i class="fas fa-boxes-stacked dd-orange"></i> Use Cases</a></li>
                        <li><a class="dropdown-item" href="/s4-pricing/"><i class="fas fa-tags dd-accent"></i> Pricing</a></li>
                        <li><a class="dropdown-item" href="/s4-roadmap/"><i class="fas fa-road dd-accent"></i> Roadmap</a></li>
                        <li><a class="dropdown-item" href="/s4-faq/"><i class="fas fa-question-circle dd-accent"></i> FAQ</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <button class="nav-link search-btn" onclick="openSearch()"><i class="fas fa-search"></i></button>
                </li>
                <li class="nav-item ms-2">
                    <a class="btn-accent" href="/s4-login/">Sign In</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

    <!-- HERO -->
    <div class="page-hero">
        <h1><i class="fas fa-link" style="margin-right:12px;color:var(--accent)"></i><span class="gradient-text">XRPL</span> Transactions</h1>
        <p>Browse every defense record anchored to the XRP Ledger in real time</p>
    </div>

    <div class="container">
        <!-- Live indicator + stats -->
        <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
            <span class="live-indicator"><span class="live-dot"></span> Live &mdash; Auto-refreshing every 5s</span>
            <button class="export-btn" onclick="exportTxCSV()"><i class="fas fa-download"></i> Export CSV</button>
        </div>

        <div class="stat-row">
            <div class="stat-box"><div class="stat-value" id="totalTx">&mdash;</div><div class="stat-label">Total Transactions</div></div>
            <div class="stat-box"><div class="stat-value" id="totalFees">&mdash;</div><div class="stat-label">Total $SLS Fees</div></div>
            <div class="stat-box"><div class="stat-value" id="branchCount">&mdash;</div><div class="stat-label">Military Branches</div></div>
            <div class="stat-box"><div class="stat-value" id="typeCount">&mdash;</div><div class="stat-label">Record Types</div></div>
        </div>

        <!-- Filters -->
        <div class="card reveal">
            <div class="filter-bar">
                <select class="filter-select" id="branchFilter" onchange="applyFilters()">
                    <option value="all">All Branches</option>
                </select>
                <select class="filter-select" id="typeFilter" onchange="applyFilters()">
                    <option value="all">All Record Types</option>
                </select>
                <select class="filter-select" id="platformFilter" onchange="applyFilters()">
                    <option value="all">All Platforms</option>
                </select>
                <input type="text" class="search-input" id="searchInput" placeholder="Search by hash, type, or system..." oninput="applyFilters()">
            </div>
        </div>

        <!-- Transactions Table -->
        <div class="card reveal">
            <div class="scroll-container">
                <div class="tx-table-wrap">
                    <table class="tx-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Branch</th>
                                <th>Record Type</th>
                                <th>System</th>
                                <th>Hash</th>
                                <th>TX Hash</th>
                                <th>Fee</th>
                                <th>Explorer</th>
                            </tr>
                        </thead>
                        <tbody id="txBody">
                            <tr><td colspan="8" class="no-data"><i class="fas fa-spinner fa-spin"></i> Loading transactions...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="pagination-bar">
                <button class="page-btn" id="prevBtn" onclick="changePage(-1)" disabled><i class="fas fa-chevron-left"></i> Previous</button>
                <span class="page-info" id="pageInfo">Page 1</span>
                <button class="page-btn" id="nextBtn" onclick="changePage(1)">Next <i class="fas fa-chevron-right"></i></button>
            </div>
        </div>

        <div style="text-align:center;padding:24px 20px;color:var(--text-secondary);font-size:0.9rem;">
            <p><i class="fas fa-satellite-dish" style="color:var(--accent);margin-right:6px;"></i> Data sourced from XRPL public ledger via account <a href="https://livenet.xrpl.org/accounts/r95GyZac4butvVcsTWUPpxzekmyzaHsTA5" target="_blank" style="color:var(--accent);font-family:monospace;">r95GyZac...TA5</a></p>
            <p style="margin-top:5px;">All transactions are verifiable on-chain. <a href="https://xrpl.org" target="_blank" style="color:var(--gold);">Learn about XRPL &rarr;</a></p>
        </div>

        <!-- ILS Workspace Cross-Link -->
        <div class="card reveal" style="border-color:rgba(0,170,255,0.3);background:linear-gradient(135deg,rgba(0,170,255,0.04),rgba(20,241,149,0.02));text-align:center;margin-top:20px;">
            <h3 style="margin-bottom:8px;"><i class="fas fa-brain" style="color:var(--accent);margin-right:8px;"></i> ILS Workspace</h3>
            <p style="color:var(--text-secondary);font-size:0.88rem;margin-bottom:16px;">Anchored records feed directly into ILS tools — track obsolescence, readiness, lifecycle costs, and generate action items from your transaction data.</p>
            <div style="display:flex;justify-content:center;gap:10px;flex-wrap:wrap;">
                <a href="/demo-app/#tabILS" style="background:linear-gradient(135deg,#00aaff,#0088cc);color:#fff;padding:10px 22px;border-radius:10px;text-decoration:none;font-weight:700;font-size:0.9rem;transition:all 0.3s;display:inline-flex;align-items:center;gap:6px;"><i class="fas fa-brain"></i> Open ILS Workspace</a>
                <a href="/metrics.html" style="background:rgba(201,168,76,0.12);color:var(--gold);border:1px solid rgba(201,168,76,0.3);padding:10px 22px;border-radius:10px;text-decoration:none;font-weight:700;font-size:0.9rem;transition:all 0.3s;display:inline-flex;align-items:center;gap:6px;"><i class="fas fa-chart-bar"></i> Live Metrics</a>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="site-footer">
    <div class="footer-grid">
        <div>
            <a href="/" class="footer-brand-link">
                <img src="/s4-assets/S4Ledger_logo.png" alt="S4">
                S4 Ledger
            </a>
            <p class="footer-tagline">Immutable logistics verification anchored to the XRP Ledger. The secure standard for defense and enterprise supply chains.</p>
            <div class="footer-social">
                <a href="https://github.com/S4-Ledger" aria-label="GitHub"><i class="fab fa-github"></i></a>
                <a href="https://x.com/S4Ledger" aria-label="X"><i class="fab fa-x-twitter"></i></a>
                <a href="https://discord.gg/s4ledger" aria-label="Discord"><i class="fab fa-discord"></i></a>
            </div>
        </div>
        <div class="footer-col">
            <h5>Product</h5>
            <a href="/demo-app/">ILS Workspace</a>
            <a href="/sdk/">SDK Docs</a>
            <a href="/sdk-playground/">SDK Playground</a>
            <a href="/s4-marketplace/">Marketplace</a>
            <a href="/s4-pricing/">Pricing</a>
        </div>
        <div class="footer-col">
            <h5>Company</h5>
            <a href="/s4-about/">About</a>
            <a href="/s4-investors/">Investors</a>
            <a href="/s4-partners/">Partners</a>
            <a href="/s4-roadmap/">Roadmap</a>
            <a href="/s4-contact/">Contact</a>
        </div>
        <div class="footer-col">
            <h5>Resources</h5>
            <a href="/s4-use-cases/">Use Cases</a>
            <a href="/s4-faq/">FAQ</a>
            <a href="/metrics.html">Metrics</a>
            <a href="/transactions.html">Transactions</a>
            <a href="/security/">Security</a>
        </div>
    </div>
    <div class="footer-bottom">
        <span>&copy; 2025 S4 Ledger. All rights reserved.</span>
        <div class="footer-bottom-links">
            <a href="/s4-terms/">Terms</a>
            <a href="/s4-privacy/">Privacy</a>
            <a href="/security/">Security</a>
        </div>
    </div>
</footer>

    <button class="back-to-top" id="backToTop" onclick="window.scrollTo({top:0,behavior:'smooth'})">&#8593;</button>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/s4-assets/main.js"></script>
    <script>
    // ═══════════════════════════════════════════════════════
    //  S4 LEDGER — LIVE TRANSACTIONS PAGE
    // ═══════════════════════════════════════════════════════

    // ── localStorage cross-page record sync ──
    const S4_STORAGE_KEY = 's4_anchored_records';
    function getLocalRecords() { try { return JSON.parse(localStorage.getItem(S4_STORAGE_KEY) || '[]'); } catch { return []; } }

    const BRANCH_COLORS = {
        USN:   { bg: 'rgba(0,59,111,0.25)', color: '#66aaff', label: 'Navy' },
        USA:   { bg: 'rgba(75,83,32,0.25)', color: '#9acd32', label: 'Army' },
        USAF:  { bg: 'rgba(0,48,143,0.25)', color: '#6699ff', label: 'Air Force' },
        USMC:  { bg: 'rgba(204,0,0,0.25)',  color: '#ff6666', label: 'Marines' },
        USCG:  { bg: 'rgba(0,51,102,0.25)', color: '#6699cc', label: 'Coast Guard' },
        DLA:   { bg: 'rgba(26,58,92,0.25)', color: '#8ab4d8', label: 'DLA' },
        JOINT: { bg: 'rgba(74,74,74,0.25)', color: '#aaaaaa', label: 'Joint' },
        SOCOM: { bg: 'rgba(45,45,45,0.25)', color: '#999999', label: 'SOCOM' },
        USSF:  { bg: 'rgba(20,20,60,0.25)', color: '#aaaaff', label: 'Space Force' },
    };

    let allTransactions = [];
    let filteredTransactions = [];
    let currentPage = 1;
    const PAGE_SIZE = 50;
    let branchesPopulated = false;

    async function loadTransactions() {
        branchesPopulated = false;
        try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 8000);
            const res = await fetch('/api/transactions', { signal: controller.signal });
            clearTimeout(timeoutId);
            const data = await res.json();
            allTransactions = data.transactions || [];

            // Merge locally-anchored records from localStorage
            const localRecs = getLocalRecords();
            if (localRecs.length > 0) {
                allTransactions = [...localRecs.map(r => ({...r, _local: true})).reverse(), ...allTransactions];
            }

            // Stats
            document.getElementById('totalTx').textContent = allTransactions.length.toLocaleString();
            document.getElementById('totalFees').textContent = '$' + (allTransactions.length * 0.01).toFixed(2);

            const branches = new Set(allTransactions.map(t => t.branch).filter(Boolean));
            const types = new Set(allTransactions.map(t => t.record_label || t.record_type).filter(Boolean));
            document.getElementById('branchCount').textContent = branches.size;
            document.getElementById('typeCount').textContent = types.size;

            populateFilters(branches, types);
            applyFilters();
        } catch (err) {
            console.warn('API fetch failed, loading from localStorage:', err.message);
            // Fallback: build transaction list entirely from localStorage
            const localRecs = getLocalRecords();
            if (localRecs.length > 0) {
                allTransactions = localRecs.map(r => ({...r, _local: true})).reverse();
                document.getElementById('totalTx').textContent = allTransactions.length.toLocaleString();
                document.getElementById('totalFees').textContent = '$' + (allTransactions.length * 0.01).toFixed(2);
                const branches = new Set(allTransactions.map(t => t.branch).filter(Boolean));
                const types = new Set(allTransactions.map(t => t.record_label || t.record_type).filter(Boolean));
                document.getElementById('branchCount').textContent = branches.size;
                document.getElementById('typeCount').textContent = types.size;
                branchesPopulated = false;
                populateFilters(branches, types);
                applyFilters();
            } else {
                document.getElementById('txBody').innerHTML = '<tr><td colspan="8" class="no-data"><i class="fas fa-info-circle" style="color:var(--accent);"></i> No transactions yet. Anchor records in the <a href="/demo-app/" style="color:var(--accent);">Demo App</a> to see them here.</td></tr>';
                document.getElementById('totalTx').textContent = '0';
                document.getElementById('totalFees').textContent = '$0.00';
                document.getElementById('branchCount').textContent = '0';
                document.getElementById('typeCount').textContent = '0';
            }
        }
    }

    function populateFilters(branches, types) {
        const branchSelect = document.getElementById('branchFilter');
        const typeSelect = document.getElementById('typeFilter');
        const prevBranch = branchSelect.value;
        const prevType = typeSelect.value;

        // Clear and rebuild branch filter
        branchSelect.innerHTML = '<option value="all">All Branches</option>';
        branches.forEach(b => {
            const info = BRANCH_COLORS[b] || { label: b };
            const opt = document.createElement('option');
            opt.value = b;
            opt.textContent = info.label;
            branchSelect.appendChild(opt);
        });
        if ([...branches].includes(prevBranch)) branchSelect.value = prevBranch;

        // Clear and rebuild type filter
        typeSelect.innerHTML = '<option value="all">All Record Types</option>';
        const sortedTypes = [...types].sort();
        sortedTypes.forEach(t => {
            const opt = document.createElement('option');
            opt.value = t;
            opt.textContent = t;
            typeSelect.appendChild(opt);
        });
        if (sortedTypes.includes(prevType)) typeSelect.value = prevType;

        branchesPopulated = true;
    }

    function applyFilters() {
        const branch = document.getElementById('branchFilter').value;
        const type = document.getElementById('typeFilter').value;
        const search = document.getElementById('searchInput').value.toLowerCase();

        filteredTransactions = allTransactions.filter(tx => {
            if (branch !== 'all' && tx.branch !== branch) return false;
            const label = tx.record_label || tx.record_type || '';
            if (type !== 'all' && label !== type) return false;
            if (search) {
                const searchable = [
                    tx.hash, tx.tx_hash, label, tx.system, tx.branch, tx.timestamp_display
                ].join(' ').toLowerCase();
                if (!searchable.includes(search)) return false;
            }
            return true;
        });

        currentPage = 1;
        renderTable();
    }

    function renderTable() {
        const tbody = document.getElementById('txBody');
        const start = (currentPage - 1) * PAGE_SIZE;
        const end = start + PAGE_SIZE;
        const pageData = filteredTransactions.slice(start, end);
        const totalPages = Math.max(1, Math.ceil(filteredTransactions.length / PAGE_SIZE));

        if (pageData.length === 0) {
            tbody.innerHTML = '<tr><td colspan="8" class="no-data">No transactions match your filters.</td></tr>';
        } else {
            tbody.innerHTML = pageData.map(tx => {
                const bc = BRANCH_COLORS[tx.branch] || { bg: 'rgba(100,100,100,0.2)', color: '#999', label: tx.branch };
                const hashShort = (tx.hash || '').substring(0, 12) + '...';
                const txHashShort = (tx.tx_hash || '').substring(0, 14) + '...';
                const label = tx.record_label || tx.record_type || 'Unknown';
                const icon = tx.icon || '<i class="fas fa-clipboard-list"></i>';
                const explorerUrl = 'https://livenet.xrpl.org/transactions/' + (tx.tx_hash || '');
                return `<tr>
                    <td style="color:var(--accent);white-space:nowrap;font-size:0.82rem;">${tx.timestamp_display || ''}</td>
                    <td><span class="branch-badge" style="background:${bc.bg};color:${bc.color};">${icon} ${bc.label}</span></td>
                    <td><span class="type-badge">${label}</span></td>
                    <td style="font-size:0.82rem;color:var(--text-muted);">${tx.system || 'N/A'}</td>
                    <td><span class="tx-hash" title="${tx.hash}" onclick="copyHash('${tx.hash}')">${hashShort}</span></td>
                    <td><span class="tx-hash" title="${tx.tx_hash}" onclick="copyHash('${tx.tx_hash}')">${txHashShort}</span></td>
                    <td><span class="fee-badge">$${(tx.fee || 0.01).toFixed(2)}</span></td>
                    <td><a href="${explorerUrl}" target="_blank" class="explorer-link"><i class="fas fa-external-link-alt"></i></a></td>
                </tr>`;
            }).join('');
        }

        // Pagination
        document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages} (${filteredTransactions.length} records)`;
        document.getElementById('prevBtn').disabled = currentPage <= 1;
        document.getElementById('nextBtn').disabled = currentPage >= totalPages;
    }

    function changePage(delta) {
        const totalPages = Math.ceil(filteredTransactions.length / PAGE_SIZE);
        currentPage = Math.max(1, Math.min(totalPages, currentPage + delta));
        renderTable();
        // Scroll to top of table
        document.querySelector('.tx-table-wrap').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function copyHash(hash) {
        navigator.clipboard.writeText(hash).then(() => {
            // Brief visual feedback
            const el = event.target;
            const orig = el.textContent;
            el.textContent = 'Copied!';
            el.style.color = '#14f195';
            setTimeout(() => { el.textContent = orig; el.style.color = ''; }, 1200);
        });
    }

    function exportTxCSV() {
        if (filteredTransactions.length === 0) { alert('No transactions to export.'); return; }
        const headers = ['Timestamp', 'Branch', 'Record Type', 'System', 'Hash', 'TX Hash', 'Fee ($SLS)'];
        const rows = [headers.join(',')];
        filteredTransactions.forEach(tx => {
            rows.push([
                '"' + (tx.timestamp_display || '') + '"',
                '"' + (tx.branch || '') + '"',
                '"' + (tx.record_label || tx.record_type || '') + '"',
                '"' + (tx.system || '') + '"',
                '"' + (tx.hash || '') + '"',
                '"' + (tx.tx_hash || '') + '"',
                (tx.fee || 0.01).toFixed(2)
            ].join(','));
        });
        const blob = new Blob([rows.join('\n')], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 's4_transactions_' + new Date().toISOString().split('T')[0] + '.csv';
        link.click();
    }

    // ── Cross-page sync: instantly update when records are anchored elsewhere ──
    window.addEventListener('storage', (e) => {
        if (e.key === S4_STORAGE_KEY) loadTransactions();
    });

    // ── Init ──
    window.addEventListener('DOMContentLoaded', loadTransactions);
    setInterval(loadTransactions, 5000);
    </script>
<link rel="stylesheet" href="/s4-assets/s4-mobile.css">
<script src="/s4-assets/s4-background.js"></script>
<!-- Search Modal -->
<div id="searchOverlay" style="display:none;position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.8);backdrop-filter:blur(8px);justify-content:center;align-items:flex-start;padding-top:20vh;">
    <div style="width:90%;max-width:560px;">
        <input id="searchInput" type="text" placeholder="Search S4 Ledger..." style="width:100%;padding:18px 24px;border-radius:14px;border:1px solid rgba(0,170,255,0.3);background:rgba(17,17,24,0.95);color:#f0f0f5;font-size:1.1rem;outline:none;font-family:'Inter',sans-serif;">
    </div>
</div>
<script>
function openSearch(){const o=document.getElementById('searchOverlay');o.style.display='flex';document.getElementById('searchInput').focus();}
document.addEventListener('keydown',e=>{if(e.key==='Escape')document.getElementById('searchOverlay').style.display='none';if((e.metaKey||e.ctrlKey)&&e.key==='k'){e.preventDefault();openSearch();}});
document.getElementById('searchOverlay')?.addEventListener('click',function(e){if(e.target===this)this.style.display='none';});
</script>
</body>
</html>